import{_ as e,c as a,o,ag as l}from"./chunks/framework.dvv-DFtf.js";const h=JSON.parse('{"title":"SDK & Contract Optimization Evaluation Plan (GBT5.2 Recommendations)","description":"","frontmatter":{},"headers":[],"relativePath":"guide/SDK_Optimization_Evaluation_Plan.md","filePath":"guide/SDK_Optimization_Evaluation_Plan.md","lastUpdated":1768813029000}'),i={name:"guide/SDK_Optimization_Evaluation_Plan.md"};function r(d,t,n,s,c,g){return o(),a("div",null,[...t[0]||(t[0]=[l('<h1 id="sdk-contract-optimization-evaluation-plan-gbt5-2-recommendations" tabindex="-1">SDK &amp; Contract Optimization Evaluation Plan (GBT5.2 Recommendations) <a class="header-anchor" href="#sdk-contract-optimization-evaluation-plan-gbt5-2-recommendations" aria-label="Permalink to &quot;SDK &amp; Contract Optimization Evaluation Plan (GBT5.2 Recommendations)&quot;">​</a></h1><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h2><p>本方案针对 GBT5.2 对 <code>aastar-sdk</code> 及相关合约 ABI 扫描后给出的建议进行评估，并制定后续优化计划。我们将建议分为 <strong>SDK 优化</strong>、<strong>合约安全加固</strong> 以及 <strong>架构对齐</strong> 三个维度，并根据优先级划定动作：<strong>优化 (Optimize)</strong>、<strong>置之不理 (Ignore)</strong> 或 <strong>更好的方案 (Better Solution)</strong>。</p><hr><h2 id="评估与动作列表" tabindex="-1">评估与动作列表 <a class="header-anchor" href="#评估与动作列表" aria-label="Permalink to &quot;评估与动作列表&quot;">​</a></h2><h3 id="_1-sdk-侧建议评估-packages-superpaymaster-core" tabindex="-1">1. SDK 侧建议评估 (packages/superpaymaster &amp; core) <a class="header-anchor" href="#_1-sdk-侧建议评估-packages-superpaymaster-core" aria-label="Permalink to &quot;1. SDK 侧建议评估 (packages/superpaymaster &amp; core)&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">建议点</th><th style="text-align:left;">评估</th><th style="text-align:left;">动作</th><th style="text-align:left;">理由/方案</th></tr></thead><tbody><tr><td style="text-align:left;"><strong><code>getPaymasterAndData</code> 输入上界校验</strong></td><td style="text-align:left;">高</td><td style="text-align:left;"><strong>优化 (Optimize)</strong></td><td style="text-align:left;"><code>uint128</code> 溢出或格式错误会导致 Bundler 端不可预测的失败。应在 SDK 侧拦截并抛出清晰错误。</td></tr><tr><td style="text-align:left;"><strong><code>checkEligibility</code> 移除硬编码 Sepolia</strong></td><td style="text-align:left;">中</td><td style="text-align:left;"><strong>优化 (Optimize)</strong></td><td style="text-align:left;">支持多链是 SDK 的基本要求。应允许用户传入 <code>chainId</code> 或从 <code>provider</code> 自动获取。</td></tr><tr><td style="text-align:left;"><strong><code>formatUserOpToBundlerV07</code> 字段长度严格断言</strong></td><td style="text-align:left;">高</td><td style="text-align:left;"><strong>优化 (Optimize)</strong></td><td style="text-align:left;">V0.7 格式对字节长度（如 <code>0x...</code> 字符串长度）有严格要求，由于 JS 没有原生固定长度字节类型，SDK 必须代劳检查。</td></tr></tbody></table><h3 id="_2-合约侧-基于-abi-反推-建议评估" tabindex="-1">2. 合约侧（基于 ABI 反推）建议评估 <a class="header-anchor" href="#_2-合约侧-基于-abi-反推-建议评估" aria-label="Permalink to &quot;2. 合约侧（基于 ABI 反推）建议评估&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">建议点</th><th style="text-align:left;">评估</th><th style="text-align:left;">动作</th><th style="text-align:left;">理由/方案</th></tr></thead><tbody><tr><td style="text-align:left;"><strong><code>PaymasterV4</code> 价格预言机新鲜度与权限校验</strong></td><td style="text-align:left;">极高</td><td style="text-align:left;"><strong>优化 (Optimize)</strong></td><td style="text-align:left;">关键安全路径。需确认合约源码中是否有 <code>updatedAt</code> 和 <code>roundId</code> 校验。SDK 侧无法修正，需同步到合约端。</td></tr><tr><td style="text-align:left;"><strong><code>SuperPaymasterV3</code> 债务隔离与 Slash 路径</strong></td><td style="text-align:left;">高</td><td style="text-align:left;"><strong>优化 (Optimize)</strong></td><td style="text-align:left;">多运营方模式下，用户债务必须隔离。Slash 逻辑需严格绑定 BLS 证明，防止误伤或攻击。</td></tr><tr><td style="text-align:left;"><strong><code>BLS/DVT</code> 聚合签名实操验证</strong></td><td style="text-align:left;">极高</td><td style="text-align:left;"><strong>更好的方案 (Better Solution)</strong></td><td style="text-align:left;">若目前仅为逻辑占位，主网前必须实现完整的 BLS 配对验证，或先行降级为多签治理方案以保安全。</td></tr><tr><td style="text-align:left;"><strong><code>Registry</code> 重放攻击防御 (Epoch/Nonce)</strong></td><td style="text-align:left;">中</td><td style="text-align:left;"><strong>优化 (Optimize)</strong></td><td style="text-align:left;">Reputation 同步必须单调递增或带 Nonce，防止过期状态覆盖新状态。</td></tr><tr><td style="text-align:left;"><strong><code>ReputationSystemV3</code> 数组上限与 NFT 真实性</strong></td><td style="text-align:left;">中</td><td style="text-align:left;"><strong>优化 (Optimize)</strong></td><td style="text-align:left;">防止 Gas DoS 攻击。NFT Boost 必须做 <code>balanceOf</code> 校验而非仅仅依赖输入数组。</td></tr></tbody></table><hr><h2 id="执行计划与优先级" tabindex="-1">执行计划与优先级 <a class="header-anchor" href="#执行计划与优先级" aria-label="Permalink to &quot;执行计划与优先级&quot;">​</a></h2><h3 id="第一阶段-sdk-鲁棒性增强-priority-p0" tabindex="-1">第一阶段：SDK 鲁棒性增强 (Priority: P0) <a class="header-anchor" href="#第一阶段-sdk-鲁棒性增强-priority-p0" aria-label="Permalink to &quot;第一阶段：SDK 鲁棒性增强 (Priority: P0)&quot;">​</a></h3><p><strong>目标</strong>：确保 SDK 生成的 Payload 100% 符合规范，并能拦截低级输入错误。</p><ul><li>[ ] 在 <code>getPaymasterAndData</code> 中增加 <code>uint128</code> 范围检查与地址合法性检查。</li><li>[ ] 重构 <code>checkEligibility</code>，支持从配置或环境中读取 <code>chainId</code>。</li><li>[ ] 为 <code>formatUserOpToBundlerV07</code> 增加对 <code>Hex</code> 长度的显式断言。</li></ul><h3 id="第二阶段-合约安全与逻辑核对-priority-p1" tabindex="-1">第二阶段：合约安全与逻辑核对 (Priority: P1) <a class="header-anchor" href="#第二阶段-合约安全与逻辑核对-priority-p1" aria-label="Permalink to &quot;第二阶段：合约安全与逻辑核对 (Priority: P1)&quot;">​</a></h3><p><strong>目标</strong>：将 ABI 发现的高风险点在合约源码中进行逐一核对与修复。</p><ul><li>[ ] 对接 <code>SuperPaymaster</code> 仓库，核对 <code>PaymasterV4</code> 和 <code>SuperPaymasterV3</code> 的关键权限代码。</li><li>[ ] 评估 <code>BLS/DVT</code> 的实现深度，并给出迁移/补全方案。</li></ul><h3 id="第三阶段-文档与标准对齐-priority-p2" tabindex="-1">第三阶段：文档与标准对齐 (Priority: P2) <a class="header-anchor" href="#第三阶段-文档与标准对齐-priority-p2" aria-label="Permalink to &quot;第三阶段：文档与标准对齐 (Priority: P2)&quot;">​</a></h3><p><strong>目标</strong>：更新技术文档，确保 SDK 行为与合约逻辑完全一致。</p><ul><li>[ ] 更新 <code>projects/aastar-sdk/docs</code> 下的各组件文档。</li></ul><hr><h2 id="备注" tabindex="-1">备注 <a class="header-anchor" href="#备注" aria-label="Permalink to &quot;备注&quot;">​</a></h2><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p>由于本仓库仅包含 ABI 且当前处于 SDK 开发模式，上述合约侧建议需在切换至合约仓库时强制执行。SDK 的优化可即刻开始。</p></div>',23)])])}const y=e(i,[["render",r]]);export{h as __pageData,y as default};
