import{_ as a,c as i,o as e,ag as l}from"./chunks/framework.dvv-DFtf.js";const k=JSON.parse('{"title":"SDK ABI 维护计划","description":"","frontmatter":{},"headers":[],"relativePath":"guide/docs/ABI_MAINTENANCE_PLAN.md","filePath":"guide/docs/ABI_MAINTENANCE_PLAN.md","lastUpdated":null}'),t={name:"guide/docs/ABI_MAINTENANCE_PLAN.md"};function n(r,s,o,p,h,d){return e(),i("div",null,[...s[0]||(s[0]=[l(`<h1 id="sdk-abi-维护计划" tabindex="-1">SDK ABI 维护计划 <a class="header-anchor" href="#sdk-abi-维护计划" aria-label="Permalink to &quot;SDK ABI 维护计划&quot;">​</a></h1><h2 id="命名策略-最终版" tabindex="-1">命名策略（最终版） <a class="header-anchor" href="#命名策略-最终版" aria-label="Permalink to &quot;命名策略（最终版）&quot;">​</a></h2><p><strong>统一无版本号命名</strong>：</p><ul><li>文件名：<code>BLSAggregator.json</code>（无 V3 后缀）</li><li>版本信息：通过 ABI 的 <code>version()</code> 函数获取</li><li>同步时自动去除版本号后缀</li></ul><h2 id="最终-abi-配置-20个" tabindex="-1">最终 ABI 配置（20个） <a class="header-anchor" href="#最终-abi-配置-20个" aria-label="Permalink to &quot;最终 ABI 配置（20个）&quot;">​</a></h2><h3 id="从-superpaymaster-同步-16个" tabindex="-1">从 SuperPaymaster 同步（16个） <a class="header-anchor" href="#从-superpaymaster-同步-16个" aria-label="Permalink to &quot;从 SuperPaymaster 同步（16个）&quot;">​</a></h3><h4 id="核心合约-13个" tabindex="-1">核心合约（13个） <a class="header-anchor" href="#核心合约-13个" aria-label="Permalink to &quot;核心合约（13个）&quot;">​</a></h4><p>来源：<code>SuperPaymaster/abis/*.json</code>（同步时去除版本号）</p><ul><li>BLSAggregator.json ← BLSAggregatorV3.json</li><li>BLSValidator.json</li><li>DVTValidator.json ← DVTValidatorV3.json</li><li>GToken.json</li><li>GTokenStaking.json</li><li>MySBT.json</li><li>PaymasterFactory.json</li><li>PaymasterV4_2.json</li><li>Registry.json</li><li>ReputationSystem.json ← ReputationSystemV3.json</li><li>SuperPaymaster.json ← SuperPaymasterV3.json</li><li>xPNTsFactory.json</li><li>xPNTsToken.json</li></ul><h4 id="aa-标准-3个" tabindex="-1">AA 标准（3个） <a class="header-anchor" href="#aa-标准-3个" aria-label="Permalink to &quot;AA 标准（3个）&quot;">​</a></h4><p>来源：<code>SuperPaymaster/out/*.sol/*.json</code>（提取 <code>.abi</code> 字段）</p><ul><li>EntryPoint.json</li><li>SimpleAccount.json</li><li>SimpleAccountFactory.json</li></ul><h3 id="sdk-自维护-4个" tabindex="-1">SDK 自维护（4个） <a class="header-anchor" href="#sdk-自维护-4个" aria-label="Permalink to &quot;SDK 自维护（4个）&quot;">​</a></h3><ul><li>SimpleAccountV08.json</li><li>SimpleAccountFactoryV08.json</li><li>Simple7702Account.json</li><li>Eip7702Support.json</li><li>SenderCreator.json</li><li>LegacyAccount.json</li><li>UserOperationLib.json</li></ul><h2 id="自动同步流程" tabindex="-1">自动同步流程 <a class="header-anchor" href="#自动同步流程" aria-label="Permalink to &quot;自动同步流程&quot;">​</a></h2><h3 id="触发" tabindex="-1">触发 <a class="header-anchor" href="#触发" aria-label="Permalink to &quot;触发&quot;">​</a></h3><p>每次运行回归测试前自动同步：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tsx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scripts/phase1_verify_contracts.ts</span></span></code></pre></div><h3 id="同步步骤" tabindex="-1">同步步骤 <a class="header-anchor" href="#同步步骤" aria-label="Permalink to &quot;同步步骤&quot;">​</a></h3><p><strong>步骤1</strong>：合约地址</p><ul><li><code>SuperPaymaster/deployments/sepolia.json</code> → SDK <code>.env.sepolia</code></li></ul><p><strong>步骤2.1</strong>：核心合约 ABI（13个）</p><ul><li><code>SuperPaymaster/abis/*.json</code> → SDK <code>packages/core/src/abis/</code></li><li><strong>自动去除版本号</strong>：<code>BLSAggregatorV3.json</code> → <code>BLSAggregator.json</code></li></ul><p><strong>步骤2.2</strong>：AA 标准 ABI（3个）</p><ul><li>从 <code>SuperPaymaster/out/</code> 提取纯 ABI 数组</li></ul><p><strong>步骤3</strong>：环境配置（可选）</p><ul><li>提示手动复制 <code>.env.sepolia</code></li></ul><h2 id="典型使用场景" tabindex="-1">典型使用场景 <a class="header-anchor" href="#典型使用场景" aria-label="Permalink to &quot;典型使用场景&quot;">​</a></h2><h3 id="场景1-更新核心合约-最常见" tabindex="-1">场景1：更新核心合约（最常见） <a class="header-anchor" href="#场景1-更新核心合约-最常见" aria-label="Permalink to &quot;场景1：更新核心合约（最常见）&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在 SuperPaymaster 修改合约</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> SuperPaymaster</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forge</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./extract_abis.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 切换到 SDK，运行测试（自动同步）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ../aastar-sdk</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tsx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scripts/phase1_verify_contracts.ts</span></span></code></pre></div><p><strong>自动执行</strong>：</p><ol><li>同步合约地址</li><li>同步 ABI（自动去除版本号）</li><li>验证合约环境</li></ol><h3 id="场景2-查看合约版本" tabindex="-1">场景2：查看合约版本 <a class="header-anchor" href="#场景2-查看合约版本" aria-label="Permalink to &quot;场景2：查看合约版本&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { SuperPaymasterABI } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@aastar/core&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createPublicClient } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;viem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readContract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  address: superPaymasterAddress,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  abi: SuperPaymasterABI,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  functionName: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;version&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 返回: &quot;SuperPaymaster-3.2.0&quot;</span></span></code></pre></div><h2 id="维护检查清单" tabindex="-1">维护检查清单 <a class="header-anchor" href="#维护检查清单" aria-label="Permalink to &quot;维护检查清单&quot;">​</a></h2><h3 id="每次合约更新后" tabindex="-1">每次合约更新后 <a class="header-anchor" href="#每次合约更新后" aria-label="Permalink to &quot;每次合约更新后&quot;">​</a></h3><ul><li>[ ] SuperPaymaster 编译成功</li><li>[ ] <code>extract_abis.sh</code> 已运行</li><li>[ ] SDK 测试自动同步 ABI</li><li>[ ] SDK 构建成功（<code>pnpm build</code>）</li></ul><h3 id="定期检查" tabindex="-1">定期检查 <a class="header-anchor" href="#定期检查" aria-label="Permalink to &quot;定期检查&quot;">​</a></h3><ul><li>[ ] 确认无重复 ABI 文件</li><li>[ ] 确认 <code>index.ts</code> 导出完整</li><li>[ ] 确认命名统一（无版本号后缀）</li></ul><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p><strong>核心原则</strong>：</p><ol><li><strong>单一数据源</strong>：SuperPaymaster 是唯一来源</li><li><strong>自动同步</strong>：每次测试前自动更新</li><li><strong>统一命名</strong>：文件名无版本号，版本信息在 ABI 内</li><li><strong>无重复</strong>：一个合约一个 ABI 文件</li></ol><p><strong>日常使用</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 更新合约 → 编译 → 运行 SDK 测试 → 自动同步 ✅</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tsx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scripts/phase1_verify_contracts.ts</span></span></code></pre></div><p>大多数时候只更新13个核心 ABI，AA 标准和辅助 ABI 基本不变。</p>`,45)])])}const u=a(t,[["render",n]]);export{k as __pageData,u as default};
