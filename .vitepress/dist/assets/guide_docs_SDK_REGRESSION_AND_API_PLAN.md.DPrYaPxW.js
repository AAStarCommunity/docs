import{_ as a,c as s,o,ag as t}from"./chunks/framework.dvv-DFtf.js";const h=JSON.parse('{"title":"SDK 重构与回归测试计划 (SDK Regression & API Plan)","description":"","frontmatter":{},"headers":[],"relativePath":"guide/docs/SDK_REGRESSION_AND_API_PLAN.md","filePath":"guide/docs/SDK_REGRESSION_AND_API_PLAN.md","lastUpdated":null}'),i={name:"guide/docs/SDK_REGRESSION_AND_API_PLAN.md"};function l(n,e,r,c,d,p){return o(),s("div",null,[...e[0]||(e[0]=[t('<h1 id="sdk-重构与回归测试计划-sdk-regression-api-plan" tabindex="-1">SDK 重构与回归测试计划 (SDK Regression &amp; API Plan) <a class="header-anchor" href="#sdk-重构与回归测试计划-sdk-regression-api-plan" aria-label="Permalink to &quot;SDK 重构与回归测试计划 (SDK Regression &amp; API Plan)&quot;">​</a></h1><h2 id="_1-项目目标与原则" tabindex="-1">1. 项目目标与原则 <a class="header-anchor" href="#_1-项目目标与原则" aria-label="Permalink to &quot;1. 项目目标与原则&quot;">​</a></h2><p><strong>核心目标</strong>: 验证 SDK 构建完整性，基于分层架构完善 API（满足 Phase 3 场景），并执行全量回归测试。</p><p><strong>开发原则</strong>:</p><ol><li><strong>API 分层原则 (Layering)</strong>: <ul><li>优先使用 <strong>基础层 API (Base/Core SDK)</strong> 构建 <strong>业务层 API (Business API)</strong>。</li><li>如果基础层缺失，<strong>先补充基础层</strong>，再构建业务层。</li><li><em>例外情况</em>: 仅在性能瓶颈或极特殊逻辑下直接调用合约 ABI，且必须在代码中注释说明原因。</li></ul></li><li><strong>数据收集优先 (Data First)</strong>: <ul><li>集成博士论文所需的数据收集模块 (<code>TestCountManager</code>)。</li><li>提供独立的 API 套件用于实验数据采集（Gas 消耗、TPS、成功率等）。</li></ul></li><li><strong>合约稳定性</strong>: <ul><li>基于 <code>SuperPaymaster</code> 项目提供的稳定 Sepolia 合约地址 (<code>.env.sepolia</code>)。</li><li>仅在发现合约初始化缺陷时才回溯修改合约。</li></ul></li></ol><h2 id="_2-api-架构与差距分析-gap-analysis" tabindex="-1">2. API 架构与差距分析 (Gap Analysis) <a class="header-anchor" href="#_2-api-架构与差距分析-gap-analysis" aria-label="Permalink to &quot;2. API 架构与差距分析 (Gap Analysis)&quot;">​</a></h2><h3 id="_2-1-基础层-api-base-layer-packages-core-packages-contracts" tabindex="-1">2.1 基础层 API (Base Layer) - <code>packages/core</code>, <code>packages/contracts</code> <a class="header-anchor" href="#_2-1-基础层-api-base-layer-packages-core-packages-contracts" aria-label="Permalink to &quot;2.1 基础层 API (Base Layer) - `packages/core`, `packages/contracts`&quot;">​</a></h3><p><em>封装底层合约交互、类型定义、基础工具。</em></p><ul><li><strong>P0 (缺失/需增强)</strong>: <ul><li>[ ] <code>StateValidator.getAccountBalances(addresses[])</code>: 批量获取 ETH/GToken/aPNTs 余额。</li><li>[ ] <code>ContractConfigManager</code>: 适配 V3.1.1 配置读取（从 <code>.env</code> 或 Config 合约）。</li><li>[ ] <code>TestCountManager</code>: 封装实验计数器与数据打点基础方法。</li></ul></li></ul><h3 id="_2-2-业务层-api-business-layer-packages-sdk" tabindex="-1">2.2 业务层 API (Business Layer) - <code>packages/sdk</code> <a class="header-anchor" href="#_2-2-业务层-api-business-layer-packages-sdk" aria-label="Permalink to &quot;2.2 业务层 API (Business Layer) - `packages/sdk`&quot;">​</a></h3><p><em>基于基础层构建，面向最终开发者场景。</em></p><ul><li><p><strong>P0 (状态查询 - Read)</strong>:</p><ul><li>[ ] <code>CommunityClient.getCommunityInfo(account)</code>: 返回角色、Token 地址、元数据。</li><li>[ ] <code>OperatorClient.getOperatorInfo(account)</code>: 返回 Operator 类型 (Super/V4)、国库状态、质押额。</li><li>[ ] <code>ExperimentClient.collectMetrics(txHash)</code>: <strong>(新增)</strong> 收集单笔交易的实验数据（Gas, Cost, Status）。</li></ul></li><li><p><strong>P1 (核心写操作 - Write)</strong>:</p><ul><li>[ ] <code>EndUserClient.deployAccount(owner, salt?)</code>: 封装 <code>SimpleAccountFactory</code> 部署逻辑。</li><li>[ ] <code>EndUserClient.mintSBT(account)</code>: 封装 &quot;自动质押 + Mint&quot; 的组合逻辑。</li><li>[ ] <code>OperatorClient.depositFunds(amount)</code> &amp; <code>withdrawFunds()</code>: 简化质押金管理。</li><li>[ ] <code>ExperimentClient.recordBenchmark(scenarioId)</code>: <strong>(新增)</strong> 记录场景基准数据。</li></ul></li><li><p><strong>P2 (增强功能)</strong>:</p><ul><li>[ ] <code>EndUserClient.fundWithXPNTs()</code>: 社区 Token 分发辅助方法。</li></ul></li></ul><h2 id="_3-回归测试策略-scenarios" tabindex="-1">3. 回归测试策略 (Scenarios) <a class="header-anchor" href="#_3-回归测试策略-scenarios" aria-label="Permalink to &quot;3. 回归测试策略 (Scenarios)&quot;">​</a></h2><p>我们将现有的散乱脚本重构为 <strong>标准化场景测试 (Scenarios)</strong>，位于 <code>tests/scenarios/</code>。</p><h3 id="场景-1-社区生命周期-dao-launchpad" tabindex="-1">场景 1: 社区生命周期 (DAO Launchpad) <a class="header-anchor" href="#场景-1-社区生命周期-dao-launchpad" aria-label="Permalink to &quot;场景 1: 社区生命周期 (DAO Launchpad)&quot;">​</a></h3><ul><li><strong>目标</strong>: 注册社区 -&gt; 发行 xPNTs -&gt; 初始配置。</li><li><strong>原脚本</strong>: <code>09_local_test_community_lifecycle.ts</code></li><li><strong>新测试</strong>: <code>01_community_launch.test.ts</code></li><li><strong>API 验证</strong>: <code>CommunityClient</code>, <code>RegistryClient</code> (Base)。</li></ul><h3 id="场景-2-运营商入驻向导-operator-wizard" tabindex="-1">场景 2: 运营商入驻向导 (Operator Wizard) <a class="header-anchor" href="#场景-2-运营商入驻向导-operator-wizard" aria-label="Permalink to &quot;场景 2: 运营商入驻向导 (Operator Wizard)&quot;">​</a></h3><ul><li><strong>目标</strong>: 注册 SuperPaymaster Operator -&gt; 质押 GToken -&gt; 存入 aPNTs。</li><li><strong>原脚本</strong>: <code>05_test_superpaymaster.ts</code></li><li><strong>新测试</strong>: <code>02_operator_setup.test.ts</code></li><li><strong>API 验证</strong>: <code>OperatorClient</code>, <code>FundingManager</code> (Base)。</li></ul><h3 id="场景-3-终端用户体验-gasless-ux" tabindex="-1">场景 3: 终端用户体验 (Gasless UX) <a class="header-anchor" href="#场景-3-终端用户体验-gasless-ux" aria-label="Permalink to &quot;场景 3: 终端用户体验 (Gasless UX)&quot;">​</a></h3><ul><li><strong>目标</strong>: 新 EOA -&gt; 部署 AA 账户 -&gt; 领取 SBT -&gt; 发送 Gasless 交易。</li><li><strong>原脚本</strong>: <code>03_test_standard_aa.ts</code></li><li><strong>新测试</strong>: <code>03_end_user_gasless.test.ts</code></li><li><strong>API 验证</strong>: <code>EndUserClient</code>, <code>PaymasterClient</code> (Base).</li></ul><h3 id="场景-4-实验数据收集-phd-data-collection" tabindex="-1">场景 4: 实验数据收集 (PhD Data Collection) <a class="header-anchor" href="#场景-4-实验数据收集-phd-data-collection" aria-label="Permalink to &quot;场景 4: 实验数据收集 (PhD Data Collection)&quot;">​</a></h3><ul><li><strong>目标</strong>: 运行基准测试 (Baseline) vs 实验组，自动记录数据。</li><li><strong>原脚本</strong>: <code>collect_industry_baseline.ts</code></li><li><strong>新测试</strong>: <code>04_data_collection.test.ts</code></li><li><strong>API 验证</strong>: <code>ExperimentClient</code>, <code>TestCountManager</code>.</li></ul><h2 id="_4-执行计划-work-plan" tabindex="-1">4. 执行计划 (Work Plan) <a class="header-anchor" href="#_4-执行计划-work-plan" aria-label="Permalink to &quot;4. 执行计划 (Work Plan)&quot;">​</a></h2><h3 id="阶段-1-基础层与实验工具建设-1-2天" tabindex="-1">阶段 1: 基础层与实验工具建设 (1-2天) <a class="header-anchor" href="#阶段-1-基础层与实验工具建设-1-2天" aria-label="Permalink to &quot;阶段 1: 基础层与实验工具建设 (1-2天)&quot;">​</a></h3><ol><li>完善 <code>packages/core</code> 中的基础读取方法。</li><li><strong>重点</strong>: 实现 <code>ExperimentClient</code> 和 <code>TestCountManager</code>，确保数据收集通道畅通。</li></ol><h3 id="阶段-2-业务-api-实现-2-3天" tabindex="-1">阶段 2: 业务 API 实现 (2-3天) <a class="header-anchor" href="#阶段-2-业务-api-实现-2-3天" aria-label="Permalink to &quot;阶段 2: 业务 API 实现 (2-3天)&quot;">​</a></h3><ol><li>按 P0 -&gt; P1 顺序实现 <code>packages/sdk</code> 中的业务方法。</li><li>严格遵守“基础层优先”原则，代码 Review 重点检查是否绕过 SDK 直接调用合约。</li></ol><h3 id="阶段-3-场景回归与数据验证-2天" tabindex="-1">阶段 3: 场景回归与数据验证 (2天) <a class="header-anchor" href="#阶段-3-场景回归与数据验证-2天" aria-label="Permalink to &quot;阶段 3: 场景回归与数据验证 (2天)&quot;">​</a></h3><ol><li>迁移脚本至 <code>tests/scenarios/</code>。</li><li>运行全量回归：<code>pnpm test:scenarios</code>。</li><li>验证产生的实验数据格式是否符合论文要求。</li></ol><h3 id="阶段-4-demo-重构-p2-优先级" tabindex="-1">阶段 4: Demo 重构 (P2 优先级) <a class="header-anchor" href="#阶段-4-demo-重构-p2-优先级" aria-label="Permalink to &quot;阶段 4: Demo 重构 (P2 优先级)&quot;">​</a></h3><ul><li>在 <code>projects/aastar-sdk-demo</code> 仓库中进行。</li><li>基于已验证的 SDK API 改造前端逻辑。</li></ul><h2 id="_5-启动指令" tabindex="-1">5. 启动指令 <a class="header-anchor" href="#_5-启动指令" aria-label="Permalink to &quot;5. 启动指令&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 检查构建</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 运行特定场景 (开发中)</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test:scenarios</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter=01_community</span></span></code></pre></div>',33)])])}const u=a(i,[["render",l]]);export{h as __pageData,u as default};
