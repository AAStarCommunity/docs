<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>L4 无 Gas 交易验证测试计划 (L4 Gasless Transaction Verification Plan) | AAStar SDK</title>
    <meta name="description" content="Build Your Own Protocol with Account Abstraction">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.B6Yvx3KD.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.Cs_ycIZN.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.ujRPEjpv.js">
    <link rel="modulepreload" href="/assets/chunks/framework.dvv-DFtf.js">
    <link rel="modulepreload" href="/assets/guide_Verifier_L4_Gasless_Plan.md.aBW_X0oP.lean.js">
    <link rel="icon" href="/favicon.ico">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="og:type" content="website">
    <meta name="og:site_name" content="AAStar SDK">
    <meta name="og:image" content="https://docs.aastar.io/og-image.png">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fcbfc0e0></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fcbfc0e0>Skip to content</a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-9fd4d1dd><div class="wrapper" data-v-9fd4d1dd><div class="container" data-v-9fd4d1dd><div class="title" data-v-9fd4d1dd><div class="VPNavBarTitle has-sidebar" data-v-9fd4d1dd data-v-9f43907a><a class="title" href="/" data-v-9f43907a><!--[--><!--]--><!--[--><img class="VPImage logo" src="/aastar-logo.png" alt data-v-ab19afbb><!--]--><span data-v-9f43907a>AAStar SDK</span><!--[--><!--]--></a></div></div><div class="content" data-v-9fd4d1dd><div class="content-body" data-v-9fd4d1dd><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9fd4d1dd><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9fd4d1dd data-v-afb2845e><span id="main-nav-aria-label" class="visually-hidden" data-v-afb2845e> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guide/getting-started.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/api/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>API</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/examples/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Examples</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guide/deployments/verify.sepolia.contracts.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Deployments</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/changelog.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>History</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9fd4d1dd data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9fd4d1dd data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/AAStarCommunity/aastar-sdk" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://discord.gg/aastar" aria-label="discord" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-discord"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9fd4d1dd data-v-f953d92f data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-bfe7971f><span class="vpi-more-horizontal icon" data-v-bfe7971f></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><!----><!--[--><!--[--><!----><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>Appearance</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-f953d92f><div class="item social-links" data-v-f953d92f><div class="VPSocialLinks social-links-list" data-v-f953d92f data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/AAStarCommunity/aastar-sdk" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://discord.gg/aastar" aria-label="discord" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-discord"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9fd4d1dd data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-9fd4d1dd><div class="divider-line" data-v-9fd4d1dd></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2488c25a><span class="vpi-align-left menu-icon" data-v-2488c25a></span><span class="menu-text" data-v-2488c25a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-6b867909><button data-v-6b867909>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-d8b57b2d data-v-42c4c606><div class="curtain" data-v-42c4c606></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-42c4c606><span class="visually-hidden" id="sidebar-aria-label" data-v-42c4c606> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-0009425e><div class="item" role="button" tabindex="0" data-v-0009425e><div class="indicator" data-v-0009425e></div><h2 class="text" data-v-0009425e>Introduction</h2><!----></div><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/guide/getting-started.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Getting Started</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/guide/installation.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Installation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/guide/quick-start.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Quick Start</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-0009425e><div class="item" role="button" tabindex="0" data-v-0009425e><div class="indicator" data-v-0009425e></div><h2 class="text" data-v-0009425e>Core Concepts</h2><!----></div><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/guide/concepts/account-abstraction.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Account Abstraction</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/guide/concepts/superpaymaster.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>SuperPaymaster (AOA+)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/guide/concepts/rainbow-bridge.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>EOA Rainbow Bridge</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/guide/concepts/reputation.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Reputation System</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-0009425e><div class="item" role="button" tabindex="0" data-v-0009425e><div class="indicator" data-v-0009425e></div><h2 class="text" data-v-0009425e>Use Cases</h2><!----></div><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/guide/use-cases/community-management.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Community Management</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/guide/use-cases/gasless-transactions.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Gasless Transactions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/guide/use-cases/operator-staking.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Operator Staking</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/guide/use-cases/yop.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Build Your Own Protocol</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-0009425e><div class="item" role="button" tabindex="0" data-v-0009425e><div class="indicator" data-v-0009425e></div><h2 class="text" data-v-0009425e>Deployments</h2><!----></div><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/guide/deployments/verify.sepolia.contracts.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Sepolia Contracts</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/guide/deployments/verify.op-sepolia.contracts.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>OP-Sepolia Contracts</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-sidebar has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>On this page</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _guide_Verifier_L4_Gasless_Plan" data-v-e6f2a212><div><h1 id="l4-无-gas-交易验证测试计划-l4-gasless-transaction-verification-plan" tabindex="-1">L4 无 Gas 交易验证测试计划 (L4 Gasless Transaction Verification Plan) <a class="header-anchor" href="#l4-无-gas-交易验证测试计划-l4-gasless-transaction-verification-plan" aria-label="Permalink to &quot;L4 无 Gas 交易验证测试计划 (L4 Gasless Transaction Verification Plan)&quot;">​</a></h1><p>本文档详细描述了在 Sepolia和其他网络参数的验证无 Gas 交易（Gasless Transactions）的详细步骤和要求。 一些信息和要求：</p><ol><li>L4是run_sdk_regression.sh 整体回归脚本的一部分，完成gasless的账户数据check和准备和交易测试。</li><li>所有私钥、RPC等私密信息，来自于根目录的.env.sepolia（或者对应的网络,例如.env.op-sepolia, .env.mainnet, .env.anvil）</li><li>使用SDK 提供的合约ABI（来源是根目录的abis）</li><li>所有合约地址来自于根目录的config.sepolia.json（或者对应的config.network.json)，包括唯一hash。</li><li>所有L4的数据准备、检查、初始化和交易测试，要求是幂等的，即可以重复执行，不会对系统和要进行的测试计划造成影响。</li><li>L4 测试的目标，是使用L1,L2,L3积累和验证过的API（就是根目录的 run_sdk_regression.sh），来完成可重复的gasless交易全过程。</li><li>兼容不同网络参数：sepolia, mainnet, op-sepolia, anvil等等，但是对于anvil，L4模拟entrypoint和useroperation有一定限制，我建议L4跳过anvil的测试，你来评估是否合理。</li><li>检查、生成和初始化，然后记录log或者config并输出测试准备结果</li><li>如果API没有需要的能力，则添加API,全部使用API能力完成数据准备校验初始化和gasless交易全过程。</li><li>如果API报错，则修复，全部使用API能力</li><li>可以参考SDK的ABI和合约代码来调试</li><li>语义化函数名，避免类似getBalance, deposit, withdraw, mint, burn等太通用的函数名，使用反映业务场景的名字，例depositAPNTsToSuperPaymaster，当然不一定这个名字，但要语义化，场景匹配。</li></ol><h2 id="_1-测试账户准备-test-accounts" tabindex="-1">1. 测试账户准备 (Test Accounts) <a class="header-anchor" href="#_1-测试账户准备-test-accounts" aria-label="Permalink to &quot;1. 测试账户准备 (Test Accounts)&quot;">​</a></h2><p>需要在 <code>.env.sepolia</code> 中配置以下账户私钥：</p><ol><li><p><strong>供应商账户 (Supplier)</strong></p><ul><li><strong>Env Var</strong>: <code>PRIVATE_KEY_SUPPLIER</code></li><li><strong>用途</strong>: 提供测试 ETH (ETH Supplier)，同时也是 GToken 合约的所有者 (Owner)。</li></ul></li><li><p><strong>社区运营者 (Operators - EOAs)</strong></p><ul><li>需在 <code>.env.sepolia</code> 中添加以下私钥 (如果不存在则生成):</li><li><code>PRIVATE_KEY_JASON</code> (Admin for AAStar Community) -&gt; 负责部署 aPNTs</li><li><code>PRIVATE_KEY_BOB</code> (Admin for Bread Community) -&gt; 负责部署 bPNTs</li><li><code>PRIVATE_KEY_ANNI</code> (Admin for Demo Community) -&gt; 负责部署 cPNTs &amp; SuperPaymaster 操作</li></ul></li><li><p><strong>测试 AA 账户 (AA Users)</strong></p><ul><li><strong>生成方式</strong>: 使用 Jason, Bob, Anni 的私钥作为 Signer 生成 EntryPoint v0.7 兼容的 Smart Accounts。</li><li><strong>数量</strong>: 6 个 (每个 Operator 对应 2 个，或者混合使用)。</li></ul></li></ol><h2 id="_2-环境初始化要求-initialization-requirements" tabindex="-1">2. 环境初始化要求 (Initialization Requirements) <a class="header-anchor" href="#_2-环境初始化要求-initialization-requirements" aria-label="Permalink to &quot;2. 环境初始化要求 (Initialization Requirements)&quot;">​</a></h2><p>这些步骤作为“一次性准备工作”运行（One-time Setup），将通过 <code>scripts/l4-setup.ts</code> 完成。</p><h3 id="_2-1-资金分发-funding" tabindex="-1">2.1 资金分发 (Funding) <a class="header-anchor" href="#_2-1-资金分发-funding" aria-label="Permalink to &quot;2.1 资金分发 (Funding)&quot;">​</a></h3><ol><li><strong>GToken 分发</strong>: 使用 Supplier Key (Owner) 铸造 (Mint) GToken: <ul><li>给 <strong>Jason</strong>: 100,000 GToken (Stake for PaymasterV4)</li><li>给 <strong>Bob</strong>: 100,000 GToken (Stake for PaymasterV4)</li><li>给 <strong>Anni</strong>: <strong>200,000 GToken</strong> (100k for Community Stake + Extra for SuperPaymaster Stake/Deposit)</li></ul></li><li><strong>ETH 分发</strong>: 使用 Supplier Key 发送测试 ETH 给 3 个 Operator (确保足够 Gas 用于部署合约)。</li></ol><h3 id="_2-2-社区与代币启动-community-token-launch" tabindex="-1">2.2 社区与代币启动 (Community &amp; Token Launch) <a class="header-anchor" href="#_2-2-社区与代币启动-community-token-launch" aria-label="Permalink to &quot;2.2 社区与代币启动 (Community &amp; Token Launch)&quot;">​</a></h3><ol><li><strong>AAStar Community (Jason)</strong><ul><li>注册社区。</li><li>部署社区代币 <strong>aPNTs</strong>。</li><li>部署 <strong>PaymasterV4</strong> (常规 Paymaster)。</li><li><strong>Action</strong>: Mint 100,000 aPNTs 给 Anni (用于 Anni 的 SuperPaymaster 存款)。</li></ul></li><li><strong>Bread Community (Bob)</strong><ul><li>注册社区。</li><li>部署社区代币 <strong>bPNTs</strong>。</li><li>部署 <strong>PaymasterV4</strong> (常规 Paymaster，接受 bPNTs)。</li></ul></li><li><strong>Demo Community (Anni)</strong><ul><li>注册社区。</li><li>部署社区代币 <strong>cPNTs</strong>。</li></ul></li></ol><h3 id="_2-3-paymaster-启动" tabindex="-1">2.3 Paymaster 启动 <a class="header-anchor" href="#_2-3-paymaster-启动" aria-label="Permalink to &quot;2.3 Paymaster 启动&quot;">​</a></h3><ol><li><strong>Launch PaymasterV4s</strong>: 确保 Jason 和 Bob 的 PaymasterV4 已部署并存入 ETH (Gas) 和 GToken (Stake)。</li><li><strong>Launch SuperPaymasterV3</strong>: 确保系统中有两个 SuperPaymasterV3 实例（只需在 Registry 注册）。</li><li><strong>Anni&#39;s SuperPaymaster Setup</strong>: <ul><li>Anni 使用额外 GToken 和 ETH 注册/启动一个 SuperPaymaster。</li><li>Anni 将 <strong>aPNTs</strong> (来自 Jason) 存入 SuperPaymaster 作为 Credit (Deposit)。这是 SuperPaymaster 在全局账本中的抵押品。</li></ul></li></ol><h2 id="_3-l4-无-gas-交易测试场景-test-scenarios" tabindex="-1">3. L4 无 Gas 交易测试场景 (Test Scenarios) <a class="header-anchor" href="#_3-l4-无-gas-交易测试场景-test-scenarios" aria-label="Permalink to &quot;3. L4 无 Gas 交易测试场景 (Test Scenarios)&quot;">​</a></h2><h3 id="_3-1-预备步骤-preparation-for-aa" tabindex="-1">3.1 预备步骤 (Preparation for AA) <a class="header-anchor" href="#_3-1-预备步骤-preparation-for-aa" aria-label="Permalink to &quot;3.1 预备步骤 (Preparation for AA)&quot;">​</a></h3><ol><li><strong>GToken Mint</strong>: 给所有 测试 AA 账户 Mint 1,000 GToken (Source: Supplier)。</li><li><strong>xPNTs Mint</strong>: 使用对应的 Operator 给相关 AA 账户 Mint 10,000 个 aPNTs, bPNTs, cPNTs。</li><li><strong>SBT &amp; Deposit</strong>: <ul><li>确保所有 AA 账户拥有 MySBT (通过注册任意社区获取)。</li><li>确保所有 AA 账户已存入 10,000 xPNTs 到对应的代币合约/社区 (Deposit)。</li></ul></li></ol><h3 id="_3-2-社区注册测试-community-registration-via-aa" tabindex="-1">3.2 社区注册测试 (Community Registration via AA) <a class="header-anchor" href="#_3-2-社区注册测试-community-registration-via-aa" aria-label="Permalink to &quot;3.2 社区注册测试 (Community Registration via AA)&quot;">​</a></h3><p>使用生成的 AA 账户测试注册流程：</p><ol><li><strong>Case 1 (With ETH)</strong>: 账户有测试 ETH -&gt; 注册成功。</li><li><strong>Case 2 (Gasless)</strong>: 账户无测试 ETH -&gt; 注册成功 (使用 Paymaster)。</li><li><strong>Case 3 (First Time)</strong>: 首次注册。</li><li><strong>Case 4 (Re-register)</strong>: 二次注册 (Re-register)。</li><li><strong>Case 5 (Idempotency)</strong>: 三次注册 (检查幂等性)。</li></ol><h3 id="_3-3-paymasterv4-交易-常规代币-gas" tabindex="-1">3.3 PaymasterV4 交易 (常规代币 Gas) <a class="header-anchor" href="#_3-3-paymasterv4-交易-常规代币-gas" aria-label="Permalink to &quot;3.3 PaymasterV4 交易 (常规代币 Gas)&quot;">​</a></h3><ol><li><strong>AAStar Paymaster (aPNTs)</strong>: <ul><li>AA 账户 (Signer: Jason/Anni) 使用 <strong>aPNTs</strong> 支付 Gas。</li><li>通过 AAStar 的 PaymasterV4 发起交易。</li><li>验证：成功，扣除 AA 的 aPNTs。</li></ul></li><li><strong>Bread Paymaster (bPNTs)</strong>: <ul><li>AA 账户使用 <strong>bPNTs</strong> 支付 Gas。</li><li>通过 Bread Community 的 PaymasterV4 发起交易。</li><li>验证：成功，扣除 AA 的 bPNTs。</li></ul></li></ol><h3 id="_3-4-superpaymasterv3-交易-demo-community-credit-system" tabindex="-1">3.4 SuperPaymasterV3 交易 (Demo Community - Credit System) <a class="header-anchor" href="#_3-4-superpaymasterv3-交易-demo-community-credit-system" aria-label="Permalink to &quot;3.4 SuperPaymasterV3 交易 (Demo Community - Credit System)&quot;">​</a></h3><p>目标：测试信用 (Credit)、债务 (Debt) 和 偿还 (Repayment) 逻辑。 配置：Demo Community Operator (Anni) 部署的 SuperPaymaster。</p><ol><li><p><strong>Tx 1: cPNTs Payment (Normal)</strong>:</p><ul><li>AA 账户使用 <strong>cPNTs</strong> 支付。</li><li>发起 Gasless 交易。</li><li>验证： <ul><li>AA 的 cPNTs 余额减少。</li><li>SuperPaymaster 内 Demo Community 的 <strong>aPNTs</strong> 余额减少 (底层支付)。</li></ul></li></ul></li><li><p><strong>Tx 2: Insufficient cPNTs (Credit &amp; Debt Test)</strong>:</p><ul><li><strong>场景</strong>: AA 账户没有足够的 cPNTs。</li><li><strong>前提</strong>: 账户拥有足够的 Reputation。</li><li><strong>执行</strong>: 连续发起 3 次交易。</li><li><strong>预期</strong>: <ul><li>系统给予 3 次免费交易额度 (Credit)。</li><li>交易全部成功。</li><li><strong>关键验证</strong>: 每次交易都在 cPNTs 合约中记录了 AA 的 <strong>债务 (Debt)</strong>，因为使用了 Credit。</li></ul></li></ul></li><li><p><strong>Tx 3: Run out of Credit (Blacklist/Limit)</strong>:</p><ul><li><strong>场景</strong>: 用完 3 次免费额度，继续尝试第 4 次交易。</li><li><strong>预期</strong>: 交易失败 (run out of credit)，或者被列入黑名单。</li></ul></li><li><p><strong>Tx 4: Repayment</strong>:</p><ul><li><strong>场景</strong>: AA 账户充值 cPNTs。</li><li><strong>预期</strong>: 系统自动优先偿还债务 (Pay Debt First)。检查余额是否正确反映了 (充值金额 - 债务)。</li></ul></li></ol><h2 id="_4-后续步骤" tabindex="-1">4. 后续步骤 <a class="header-anchor" href="#_4-后续步骤" aria-label="Permalink to &quot;4. 后续步骤&quot;">​</a></h2><ul><li>编写 <code>scripts/l4-setup.ts</code> 自动化上述初始化。</li><li>编写 <code>tests/regression/l4-gasless.ts</code> 执行上述测试用例。</li><li></li></ul><p>补充： xPNTsFactory合约初始化会设置SuperPaymaster内置为超级账户，可以直接从任意xPNTsFactory部署的xPNTs合约转账gas需要的xPNTs到自己的账户，不用approve。不过也提供了安全校验，只能用来转gas费用。</p><h2 id="规则补充" tabindex="-1">规则补充 <a class="header-anchor" href="#规则补充" aria-label="Permalink to &quot;规则补充&quot;">​</a></h2><h2 id="以下规则在aastar-sdk-项目生效第一-禁止创建便利性的脚本或者临时性的脚本用来什么检查余额、部署token、资助账户-这些都禁止-如果需要便利性脚本-参考第二条第二-所有过程必须使用使用我们的api-我们api有l1l2l3级别的api-都封装了基础能力-你为什么不用api-需要便利性脚本了-在test-utils模块下新增工具api-转化为可重复使用的api-为全回归测试做准备第三个-禁止产生任何编译的过程文件-如-js-d-ts-map-。如果运行-ts-脚本-必须使用-npx-tsx-直接运行-绝不执行-tsc-或其他会产生文件的编译命令。如果不慎产生-必须随后立即清理。第四-所有的环境变量配置-在根目录的-env-sepolia-不同网络-不同配置名称-例如-env-anvil-env-op-sepolia-env-mainnet-目前我们重点是在sepolia跑通全回归测试-。第五-全回归测试必须包含三个阶段-必须一步步完成-禁止未完成第一阶段-进入第二阶段-以此类推。其中-第一阶段-定义为合约环境检查-第二阶段-定义为初始化账户-eoa和aa-、社区、token、paymaster和superpaymaster-第三阶段-准备forge-script-dry-run测试useroperation是否合格-然后测试和fix-完成gasless测试。以上所有阶段的实现-都在l4-test脚本实现-通过组织和调用l1-l2-l3的sdk-api-实现关键动作-禁止借助外部临时api完成-任何步骤没有api实现了-check后可以新增api-原则参考第二条规则-最后无法完成的-抛出报错。" tabindex="-1">以下规则在aastar-sdk 项目生效 第一，禁止创建便利性的脚本或者临时性的脚本用来什么检查余额、部署token、资助账户，这些都禁止，如果需要便利性脚本，参考第二条 第二，所有过程必须使用使用我们的API，我们API有L1L2L3级别的API，都封装了基础能力，你为什么不用API，需要便利性脚本了，在test，utils模块下新增工具api，转化为可重复使用的api，为全回归测试做准备 第三个，禁止产生任何编译的过程文件（如 .js, .d.ts, .map）。如果运行 ts 脚本，<strong>必须使用 <code>npx tsx</code> 直接运行</strong>，<strong>绝不执行 <code>tsc</code> 或其他会产生文件的编译命令</strong>。如果不慎产生，必须随后立即清理。 第四，所有的环境变量配置，在根目录的.env.sepolia（不同网络，不同配置名称，例如.env.anvil, .env.op-sepolia, .env.mainnet，目前我们重点是在sepolia跑通全回归测试）。 第五，全回归测试必须包含三个阶段，必须一步步完成，禁止未完成第一阶段，进入第二阶段，以此类推。 其中，第一阶段，定义为合约环境检查，第二阶段，定义为初始化账户（EOA和AA）、社区、token、paymaster和superpaymaster，第三阶段，准备forge script dry run测试useroperation是否合格，然后测试和fix，完成gasless测试。 以上所有阶段的实现，都在L4 test脚本实现，通过组织和调用L1,L2,L3的sdk api，实现关键动作，禁止借助外部临时api完成，任何步骤没有api实现了，check后可以新增api，原则参考第二条规则， 最后无法完成的，抛出报错。 <a class="header-anchor" href="#以下规则在aastar-sdk-项目生效第一-禁止创建便利性的脚本或者临时性的脚本用来什么检查余额、部署token、资助账户-这些都禁止-如果需要便利性脚本-参考第二条第二-所有过程必须使用使用我们的api-我们api有l1l2l3级别的api-都封装了基础能力-你为什么不用api-需要便利性脚本了-在test-utils模块下新增工具api-转化为可重复使用的api-为全回归测试做准备第三个-禁止产生任何编译的过程文件-如-js-d-ts-map-。如果运行-ts-脚本-必须使用-npx-tsx-直接运行-绝不执行-tsc-或其他会产生文件的编译命令。如果不慎产生-必须随后立即清理。第四-所有的环境变量配置-在根目录的-env-sepolia-不同网络-不同配置名称-例如-env-anvil-env-op-sepolia-env-mainnet-目前我们重点是在sepolia跑通全回归测试-。第五-全回归测试必须包含三个阶段-必须一步步完成-禁止未完成第一阶段-进入第二阶段-以此类推。其中-第一阶段-定义为合约环境检查-第二阶段-定义为初始化账户-eoa和aa-、社区、token、paymaster和superpaymaster-第三阶段-准备forge-script-dry-run测试useroperation是否合格-然后测试和fix-完成gasless测试。以上所有阶段的实现-都在l4-test脚本实现-通过组织和调用l1-l2-l3的sdk-api-实现关键动作-禁止借助外部临时api完成-任何步骤没有api实现了-check后可以新增api-原则参考第二条规则-最后无法完成的-抛出报错。" aria-label="Permalink to &quot;以下规则在aastar-sdk 项目生效
第一，禁止创建便利性的脚本或者临时性的脚本用来什么检查余额、部署token、资助账户，这些都禁止，如果需要便利性脚本，参考第二条
第二，所有过程必须使用使用我们的API，我们API有L1L2L3级别的API，都封装了基础能力，你为什么不用API，需要便利性脚本了，在test，utils模块下新增工具api，转化为可重复使用的api，为全回归测试做准备
第三个，禁止产生任何编译的过程文件（如 .js, .d.ts, .map）。如果运行 ts 脚本，**必须使用 `npx tsx` 直接运行**，**绝不执行 `tsc` 或其他会产生文件的编译命令**。如果不慎产生，必须随后立即清理。
第四，所有的环境变量配置，在根目录的.env.sepolia（不同网络，不同配置名称，例如.env.anvil, .env.op-sepolia, .env.mainnet，目前我们重点是在sepolia跑通全回归测试）。
第五，全回归测试必须包含三个阶段，必须一步步完成，禁止未完成第一阶段，进入第二阶段，以此类推。
其中，第一阶段，定义为合约环境检查，第二阶段，定义为初始化账户（EOA和AA）、社区、token、paymaster和superpaymaster，第三阶段，准备forge script dry run测试useroperation是否合格，然后测试和fix，完成gasless测试。
以上所有阶段的实现，都在L4 test脚本实现，通过组织和调用L1,L2,L3的sdk api，实现关键动作，禁止借助外部临时api完成，任何步骤没有api实现了，check后可以新增api，原则参考第二条规则， 最后无法完成的，抛出报错。&quot;">​</a></h2><p>以上规则的详细版本，在docs/Verifier_L4_Gasless_Plan.md,此规则为实现gasless回归测试为目标。</p><h2 id="合约验证" tabindex="-1">合约验证 <a class="header-anchor" href="#合约验证" aria-label="Permalink to &quot;合约验证&quot;">​</a></h2><p><strong>目标</strong> 验证所有合约地址是否是最新版本，合约名称，版本号，部署日期，合约地址，都要输出和明确展示，验证是否完成了相互之间的依赖初始化。 以上需要统计合约数量（指的是由本项目开发的合约和依赖合约），目前有如下合约：</p><ol><li>Registry 60 functions，全局注册表合约</li><li>SuperPaymaster 58 functions，唯一实例的多租户Paymaster，由AAStar社区维护</li><li>MySBT 49 functions，全局唯一SBT合约，白板MySBT协议，只有你可以自由涂抹</li><li>PaymasterV4_2 48 functions ，模板合约，reg在PaymasterFactory合约一个具体实现</li><li>xPNTsToken 37 functions 模板合约,immutable方式固化在了xPNTsFactory合约</li><li>GToken 18 functions，基础GToken合约，未来要改进为销售合约</li><li>GTokenStaking 28 functions，GToken的质押管理合约</li><li>xPNTsFactory 28 functions xPNTs合约注册到工厂，然后通过工厂部署具体实现proxy</li><li>PaymasterFactory 24 functions paymaster某版本实现reg到工厂，use工厂部署实现proxy</li><li>ReputationSystem 20 functions，信用系统</li><li>BLSAggregator 18 functions，BLS聚合器</li><li>DVTValidator 15 functions，DVT验证器</li><li>BLSValidator 2 functions，BLS验证器合约</li></ol><hr><ol start="14"><li>SimpleAccount 17 functions，默认0.7版，外部依赖，符合entrypoint 0.7的合约账户</li><li>SimpleAccountV08 17 functions，外部依赖，符合entrypoint 0.8的合约账户</li><li>EntryPoint 22 functions，外部依赖，官方entrypoint</li><li>Simple7702Account 10 functions，外部依赖，符合entrypoint 0.7的合约账户</li><li>SimpleAccountFactory 4 functions，外部依赖，符合entrypoint 0.7的合约账户工厂</li><li>SimpleAccountFactoryV08 4 functions，外部依赖，符合entrypoint 0.8的合约账户工厂</li><li>SenderCreator 3 functions，外部依赖，部署AA账户的工具合约</li><li>UserOperationLib 3 functions，外部依赖，用户操作的工具合约</li></ol><p>基于工厂部署的实例：</p><ol><li>aPNTs，基于xpntsFactory部署的标准实现，提供xpnts接口的具体实例，归属于AAStar社区</li><li>bPNTs，基于xpntsFactory部署的标准实现，提供xpnts接口的具体实例，归属于Bread社区，以此类推</li><li>PaymasterV4_2-Bread，归属于Bread社区，基于paymasterFactory部署的标准实现，提供paymaster接口的具体实例，以此类推</li><li>SuperPaymaster，归属于AAStar社区，全局唯一实例，提供superpaymaster服务的多租户合约（这个是特殊实例，只有一个）</li></ol><h3 id="角色和信用等级" tabindex="-1">角色和信用等级 <a class="header-anchor" href="#角色和信用等级" aria-label="Permalink to &quot;角色和信用等级&quot;">​</a></h3><p>预置角色配置表 (Registry v3.1.1) 以下是合约构造函数中初始化的核心参数（金额单位均为 GToken/ETH 对应的 18 位小数）：</p><p>角色 (Role ID) 最小质押 (minStake) 进入销毁 (entryBurn) 退出费率 (exitFeeBP) 最小退出费 说明 ROLE_COMMUNITY 30 ETH 3 ETH 500 (5%) 1 ETH 社区运营者基础角色 ROLE_ENDUSER 0.3 ETH 0.05 ETH 1000 (10%) 0.05 ETH 终端用户角色 ROLE_PAYMASTER_SUPER 50 ETH 5 ETH 1000 (10%) 2 ETH 超级支付主角色 ROLE_PAYMASTER_AOA 30 ETH 3 ETH 1000 (10%) 1 ETH 常规 AOA 支付主 ROLE_DVT / ROLE_KMS 30~100 ETH 3~10 ETH 1000 (10%) 1~5 ETH 基础设施节点角色 [!NOTE] bra fee (entryBurn): 注册时立即扣除并销毁的部分。 stakeExit fee (exitFeeBP): 退出角色时从质押余额中扣除的比例（BP 为万分之一）。</p><p>C. 信用分等级与额度 (Credit Tiers) 系统根据 Reputation 分数自动划分等级，对应不同的 SuperPaymaster 信用额度：</p><p>等级 (Level) 信誉分阈值 (Reputation) 信用额度 (Credit Limit) Level 1 &lt; 13 0 Level 2 13 - 33 100 aPNTs Level 3 34 - 88 300 aPNTs Level 4 89 - 232 600 aPNTs Level 5 233 - 609 1000 aPNTs Level 6 610+ 2000 aPNTs 这就解释了为什么在 L4 测试中，我们需要先提升 AA 账户的 Reputation，才能触发 SuperPaymaster 的信用支付逻辑。</p><h3 id="验证" tabindex="-1">验证 <a class="header-anchor" href="#验证" aria-label="Permalink to &quot;验证&quot;">​</a></h3><p>相互之间的依赖是否初始化完成，包括：</p><ol><li>GToken是否是immutable变量在GTokenStaking合约中 (Wiring Matrix)</li></ol><ul><li><pre><code>  MySBT -&gt; Registry
</code></pre></li><li><pre><code>   GTokenStaking -&gt; Registry
</code></pre></li><li><pre><code>   xPNTsFactory -&gt; SuperPaymaster
</code></pre></li><li><pre><code>  Registry -&gt; ReputationSystem (as Source)
</code></pre></li><li><pre><code>  Registry -&gt; BLSAggregator
</code></pre></li><li><pre><code>  Registry -&gt; BLSValidator
</code></pre></li><li><pre><code>  SuperPaymaster -&gt; xPNTsFactory
</code></pre></li><li><pre><code>  SuperPaymaster -&gt; BLSAggregator
</code></pre></li><li>依赖的设置分为immutable变量设置和依赖合约地址设置，immutable变量设置在合约初始化时设置，依赖合约地址设置在合约初始化时设置（部署者/管理员调用setter函数）</li></ul><h2 id="两个方式完成合约验证-到superpaymaster项目目录-运行-forge-script-scripts-verifyv3-1-1-s-sol-来验证或者到aastar-sdk项目目录-添加checkcontract函数-借鉴verifyv3-1-1-s-sol逻辑-我们重新编写-这个还没做-需要新增checkcontract函数-来验证" tabindex="-1">两个方式完成合约验证：到superpaymaster项目目录，运行 forge script scripts/VerifyV3_1_1.s.sol 来验证 或者到aastar-sdk项目目录，添加checkContract函数（借鉴VerifyV3_1_1.s.sol逻辑，我们重新编写，这个还没做，需要新增checkContract函数），来验证 <a class="header-anchor" href="#两个方式完成合约验证-到superpaymaster项目目录-运行-forge-script-scripts-verifyv3-1-1-s-sol-来验证或者到aastar-sdk项目目录-添加checkcontract函数-借鉴verifyv3-1-1-s-sol逻辑-我们重新编写-这个还没做-需要新增checkcontract函数-来验证" aria-label="Permalink to &quot;两个方式完成合约验证：到superpaymaster项目目录，运行 forge script scripts/VerifyV3_1_1.s.sol 来验证
或者到aastar-sdk项目目录，添加checkContract函数（借鉴VerifyV3_1_1.s.sol逻辑，我们重新编写，这个还没做，需要新增checkContract函数），来验证&quot;">​</a></h2><p>TX requirements</p><p>L4 test for gasless tx, but you must check the test accounts (EOA account as operators to launch new community and deploy community xPNTs like aPNTs and bPNTs; and as a test receiver, and test AA account with entrpoint 0.7 adaptable) and and requirements(MySBT, bPNTs) and community registered() and</p><p>Test Accounts:</p><ol><li>PRIVATE_KEY_SUPPLIER in .env.sepolia as a Test ETH supplier</li><li>3 EOA as community launcher(operator) : Jason, Bob, Anni, private key in .env.sepolia</li><li>6 AA(entrypoint 0.7) accounts for gasless test, produced by API</li></ol><p>Requirements</p><ol><li>Mint GToken(100000, using supplier key, it is also the GToken contract owner) to 3 EOA accounts</li><li>Transfer test ETH(using supplier key) to 3 EOA accounts for deployment.</li><li>launch three communities and token for test <ol><li>AAStar Community and aPNTs (Jason)</li><li>breadCommunity with bPNTs (Bob)</li><li>DemoCommunity with cPNTs (Anni)</li></ol></li><li>Launch two PaymasterV4, new deployment with GToken and test ETH in EOA</li><li>Launch two SuperPaymasterV3, just register in registry with with GToken and test ETH</li><li>Use Anni to register (launch) a SuperPaymaster with extra GToken and test ETH and 100000 aPNTs in EOA <ol><li>deposit aPNTs to Super</li></ol></li><li>All above is one time job for our later test, we can make a individual test shell to prepare.</li><li>if done this, record all data, contracts, community data, accounts for next step.</li></ol><p>Test 4 kinds of gasless tx:</p><ol><li>Mint GToken to all test AA accounts(1000 is enough) ,use supplier key</li><li>Mint a,b,cPNTs to all test AA account(10000 is enough), use the community operator key(Jason, Bob, Anni)</li><li>use AA accounts to register different community(above all ) <ol><li>with test ETH</li><li>without test ETH</li><li>first time register a community</li><li>second time</li><li>third time</li></ol></li><li>All test AA accounts get MySBT (registered in any community) and deposited xPNTs(a,b, cPNTs) 10000.</li><li>Launch a tx in a PaymasterV4 by breadCommunity(they accept bPNTs as gas token). <ol><li>AA account with apnts, launch gasless tx with aastar’s paymaster V4(deployed by aastar operator)</li><li>AA account with bpnts , launch gasless tx with breadCommunity paymaster V4(deployed by breadCommunity operator)</li></ol></li><li>Launch a tx in a SuperPaymasterV3 <ol><li>AA account with cpnts , launch gasless tx with DemoCommunity SuperPaymaster V3(deployed by DemoCommunity operator Anni)</li><li>it should deduced aPNTs from DemoCommunity balance in SuperPaymaster</li><li>it should <ol><li>deduce cPNTs from test AA account</li><li>if AA account has no cPNTs balance</li><li>improve the reputation of test account enough to get credit for 3 free tx <ol><li>try more tx, it should be put into blacklist (we put it manually for now) and can’t get gasless free tx anymore, it run out the credit.</li></ol></li><li>try again, should record a debt in cPNTs contract</li><li>deposit cPNTs to test AA, it should pay debt first, then deposite</li></ol></li></ol></li></ol><hr><h2 id="_5-l4-实现计划-implementation-plan" tabindex="-1">5. L4 实现计划 (Implementation Plan) <a class="header-anchor" href="#_5-l4-实现计划-implementation-plan" aria-label="Permalink to &quot;5. L4 实现计划 (Implementation Plan)&quot;">​</a></h2><h3 id="_5-1-脚本结构" tabindex="-1">5.1 脚本结构 <a class="header-anchor" href="#_5-1-脚本结构" aria-label="Permalink to &quot;5.1 脚本结构&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 环境准备(幂等)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tsx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scripts/l4-setup.ts</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --network=sepolia</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. Gasless测试</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tsx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tests/regression/l4-gasless.ts</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --network=sepolia</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 查看状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scripts/l4-state.json</span></span></code></pre></div><h3 id="_5-2-l4-setup-ts-数据准备目标" tabindex="-1">5.2 l4-setup.ts 数据准备目标 <a class="header-anchor" href="#_5-2-l4-setup-ts-数据准备目标" aria-label="Permalink to &quot;5.2 l4-setup.ts 数据准备目标&quot;">​</a></h3><table tabindex="0"><thead><tr><th>阶段</th><th>对象</th><th>目标值</th><th>说明</th></tr></thead><tbody><tr><td><strong>Funding</strong></td><td>Jason ETH</td><td>≥0.1 ETH</td><td>部署合约Gas</td></tr><tr><td></td><td>Bob ETH</td><td>≥0.1 ETH</td><td>部署合约Gas</td></tr><tr><td></td><td>Anni ETH</td><td>≥0.1 ETH</td><td>部署合约Gas</td></tr><tr><td></td><td>Jason GToken</td><td>100,000</td><td>PaymasterV4 Stake</td></tr><tr><td></td><td>Bob GToken</td><td>100,000</td><td>PaymasterV4 Stake</td></tr><tr><td></td><td>Anni GToken</td><td><strong>200,000</strong></td><td>100k社区质押+100k SuperPM质押</td></tr><tr><td><strong>社区</strong></td><td>Jason</td><td>AAStar社区+aPNTs+PaymasterV4</td><td></td></tr><tr><td></td><td>Bob</td><td>Bread社区+bPNTs+PaymasterV4</td><td></td></tr><tr><td></td><td>Anni</td><td>Demo社区+cPNTs+SuperPM Operator</td><td></td></tr><tr><td><strong>SuperPM</strong></td><td>Anni aPNTs余额</td><td><strong>100,000</strong></td><td>Jason mint aPNTs给Anni</td></tr><tr><td></td><td>Anni SuperPM内余额</td><td>≥50,000 aPNTs</td><td>Anni存入SuperPM的credit</td></tr><tr><td><strong>AA账户</strong></td><td>6个AA</td><td>每个≥0.02 ETH, 1000 GToken</td><td></td></tr><tr><td></td><td>AA xPNTs</td><td>各10,000 a/b/cPNTs</td><td>用于Gasless测试</td></tr></tbody></table><h3 id="_5-3-关键修复事项" tabindex="-1">5.3 关键修复事项 <a class="header-anchor" href="#_5-3-关键修复事项" aria-label="Permalink to &quot;5.3 关键修复事项&quot;">​</a></h3><ol><li><p><strong>SuperPaymaster.deposit问题</strong>:</p><ul><li>合约<code>deposit(uint256 amount)</code>使用的是<code>APNTS_TOKEN</code>(全局aPNTs=<code>0xBdF389a6e402AF1C0d4A0A45396303dC0b1Cf8d2</code>)</li><li>不是Jason的社区aPNTs代币</li><li>SDK需添加<code>depositAPNTsToSuperPaymaster</code>语义化函数</li></ul></li><li><p><strong>Token数量调整</strong>:</p><ul><li>GToken: Jason/Bob 100,000, Anni 200,000</li><li>aPNTs from Jason to Anni: 100,000</li><li>SuperPM存入: 50,000 (保留50,000备用)</li></ul></li><li><p><strong>Anvil跳过评估</strong>:</p><ul><li>Anvil本地没有真实Bundler,无法测试完整UserOp流程</li><li><strong>建议L4跳过Anvil</strong>,仅在Sepolia/OP-Sepolia执行</li></ul></li></ol><h3 id="_5-3-构造userop" tabindex="-1">5.3 构造UserOp <a class="header-anchor" href="#_5-3-构造userop" aria-label="Permalink to &quot;5.3 构造UserOp&quot;">​</a></h3><ul><li>交易内容：从 Jason 的第一个 AA 账户 (Jason_AA1) 向 Bob 的 EOA 地址转移 2 个 bPNTs 代币。</li><li>签名来源：使用 Jason 的私钥（即 AA 的 Owner）对 UserOp Hash 进行了标准的 signMessage 签名。</li><li>Nonce 处理：通过 SDK 实时获取了最新的 Nonce 值 (当前为 1)。 “UserOperation 构造指南”，内容包括：</li></ul><p>Context: 明确演示背景为从 Jason (AA1) 向 Bob (EOA) 转移 2 个 bPNTs。 5 种测试场景总结: NATIVE: 标准 4337，AA 支付 ETH Gas。 GASLESS_V4: PaymasterV4 免 Gas（社区赞助）。 SUPER_BPNT: SuperPaymaster 内部结算 bPNT。 SUPER_CPNT: SuperPaymaster 内部结算 cPNT。 SUPER_CUSTOM: SuperPaymaster 自定义结算。 API 使用范例: 展示了如何通过 UserOpScenarioBuilder 简单调用即可获得符合 Bundler JSON-RPC 规范（Hex 编码）的 UserOp。 2. 验证结果 脚本运行结果显示，所有场景的 UserOp Hash 均已成功计算，且签名已由 Jason 的 Owner 私钥完成。输出的 JSON 格式已完全兼容 Alchemy Bundler 等后端的集成</p><h3 id="_5-4-l4-gasless-ts-测试场景" tabindex="-1">5.4 l4-gasless.ts 测试场景 <a class="header-anchor" href="#_5-4-l4-gasless-ts-测试场景" aria-label="Permalink to &quot;5.4 l4-gasless.ts 测试场景&quot;">​</a></h3><table tabindex="0"><thead><tr><th>#</th><th>场景</th><th>Paymaster</th><th>预期</th></tr></thead><tbody><tr><td>1</td><td>AA有ETH,直接交易</td><td>无</td><td>成功,扣ETH</td></tr><tr><td>2</td><td>AA使用aPNTs</td><td>PaymasterV4(AAStar)</td><td>成功,扣aPNTs</td></tr><tr><td>3</td><td>AA使用bPNTs</td><td>PaymasterV4(Bread)</td><td>成功,扣bPNTs</td></tr><tr><td>4</td><td>AA使用cPNTs</td><td>SuperPM(Demo)</td><td>成功,扣cPNTs,Anni aPNTs余额减少</td></tr><tr><td>5</td><td>AA无cPNTs有信用</td><td>SuperPM(Demo)</td><td>成功,记录债务</td></tr><tr><td>6</td><td>信用耗尽</td><td>SuperPM(Demo)</td><td>失败,黑名单</td></tr><tr><td>7</td><td>充值cPNTs</td><td>-</td><td>优先还债</td></tr></tbody></table><h3 id="_5-5-状态输出-l4-state-json" tabindex="-1">5.5 状态输出 (l4-state.json) <a class="header-anchor" href="#_5-5-状态输出-l4-state-json" aria-label="Permalink to &quot;5.5 状态输出 (l4-state.json)&quot;">​</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;network&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sepolia&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;timestamp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2026-01-06T20:30:00Z&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;operators&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;jason&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;address&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0x...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;community&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0x...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;paymasterV4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0x...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;bob&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;address&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0x...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;community&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0x...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;paymasterV4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0x...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;anni&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;address&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0x...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;community&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0x...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;superPM&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;balance&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;50000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;aaAccounts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;label&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Jason_AA1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;address&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0x...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;eth&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.02&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;gToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;registered&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;readyForGaslessTest&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="_6-l4-setup-sdk-api-使用清单" tabindex="-1">6. L4-Setup SDK API 使用清单 <a class="header-anchor" href="#_6-l4-setup-sdk-api-使用清单" aria-label="Permalink to &quot;6. L4-Setup SDK API 使用清单&quot;">​</a></h2><h3 id="_6-1-api-覆盖率审查" tabindex="-1">6.1 API 覆盖率审查 <a class="header-anchor" href="#_6-1-api-覆盖率审查" aria-label="Permalink to &quot;6.1 API 覆盖率审查&quot;">​</a></h3><p><code>l4-setup.ts</code> 脚本已完全基于 SDK API 实现，无直接合约调用（<code>writeContract</code>）。</p><table tabindex="0"><thead><tr><th>步骤</th><th>操作</th><th>使用的 SDK API</th><th>文件位置</th><th>状态</th></tr></thead><tbody><tr><td><strong>1. Community 注册</strong></td><td>注册 ROLE_COMMUNITY</td><td><code>CommunityClient.registerAsCommunity()</code></td><td><code>packages/community</code></td><td>✅ 完整</td></tr><tr><td><strong>2. Token 部署</strong></td><td>部署 xPNTs 社区代币</td><td><code>xPNTsFactoryActions.createToken()</code></td><td><code>packages/core/actions</code></td><td>✅ 完整</td></tr><tr><td><strong>3. Paymaster V4 部署</strong></td><td>部署并注册 Paymaster V4 + Owner 验证</td><td><code>PaymasterOperatorClient.deployAndRegisterPaymasterV4()</code></td><td><code>packages/operator</code></td><td>✅ 已增强验证</td></tr><tr><td><strong>4. AA 账户部署</strong></td><td>部署 SimpleAccount v0.7</td><td><code>accountFactoryActions.createAccount()</code></td><td><code>packages/core/actions</code></td><td>✅ 完整</td></tr><tr><td><strong>5. Token Mint</strong></td><td>Mint Token 到指定地址</td><td><code>tokenActions().mint()</code></td><td><code>packages/core/actions</code></td><td>✅ 完整</td></tr><tr><td><strong>6. Token Approve</strong></td><td>Approve Token 给 Spender</td><td><code>tokenActions().approve()</code></td><td><code>packages/core/actions</code></td><td>✅ 完整</td></tr><tr><td><strong>7. SuperPaymaster 充值</strong></td><td>向 SuperPaymaster 充值 aPNTs</td><td><code>superPaymasterActions().depositAPNTs()</code></td><td><code>packages/core/actions</code></td><td>✅ 完整</td></tr><tr><td><strong>8. Paymaster Owner 验证</strong></td><td>验证 Paymaster 初始化状态</td><td><code>publicClient.readContract()</code> + PaymasterABI</td><td><code>scripts/l4-setup.ts</code></td><td>✅ 新增防御</td></tr></tbody></table><h3 id="_6-2-关键增强" tabindex="-1">6.2 关键增强 <a class="header-anchor" href="#_6-2-关键增强" aria-label="Permalink to &quot;6.2 关键增强&quot;">​</a></h3><h4 id="_6-2-1-paymaster-owner-验证" tabindex="-1">6.2.1 Paymaster Owner 验证 <a class="header-anchor" href="#_6-2-1-paymaster-owner-验证" aria-label="Permalink to &quot;6.2.1 Paymaster Owner 验证&quot;">​</a></h4><p>在 <code>PaymasterOperatorClient.deployAndRegisterPaymasterV4()</code> 中增加了 SDK 级别的 owner 验证：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 部署完成后立即验证 owner</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> actualOwner</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> publicClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readContract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    address: paymasterAddress,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    abi: PaymasterABI,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    functionName: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;owner&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (actualOwner </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> expectedOwner) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        `Critical: Paymaster owner mismatch!</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        `  Expected: ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">expectedOwner</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        `  Actual:   ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">actualOwner</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        `  DO NOT USE THIS PAYMASTER!`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>防御效果</strong>：</p><ul><li>✅ 阻止使用未正确初始化的 Paymaster</li><li>✅ 及时发现部署问题</li><li>✅ 防止 owner 被抢跑（虽然 Factory 是原子操作，理论上不会发生）</li></ul><h4 id="_6-2-2-charlie-测试验证" tabindex="-1">6.2.2 Charlie 测试验证 <a class="header-anchor" href="#_6-2-2-charlie-测试验证" aria-label="Permalink to &quot;6.2.2 Charlie 测试验证&quot;">​</a></h4><p>通过新增 Charlie（第 4 个 operator）验证修复效果：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>📝 Registering Community for Charlie (Test)...</span></span>
<span class="line"><span>🏭 Deploying dPNTs for Charlie (Test)...</span></span>
<span class="line"><span>⛽ Deploying Paymaster V4 for Charlie (Test)...</span></span>
<span class="line"><span>Deploying Paymaster v4.2...</span></span>
<span class="line"><span>🔍 Verifying Paymaster initialization...</span></span>
<span class="line"><span>   ✅ Owner verified: 0x4F0b7d0EaD970f6573FEBaCFD0Cd1FaB3b64870D</span></span></code></pre></div><p><strong>结果</strong>：</p><ul><li>✅ 使用纯 SDK API 部署</li><li>✅ Owner 正确设置（Charlie 地址）</li><li>✅ 证明修复后的 API 不会出现 0x000 owner 问题</li></ul><h3 id="_6-3-api-设计原则" tabindex="-1">6.3 API 设计原则 <a class="header-anchor" href="#_6-3-api-设计原则" aria-label="Permalink to &quot;6.3 API 设计原则&quot;">​</a></h3><ol><li><strong>封装性</strong>：所有链上操作通过 SDK Actions 封装，脚本层不直接调用合约</li><li><strong>验证性</strong>：关键操作后自动验证状态（如 owner、balance）</li><li><strong>容错性</strong>：自动检查前置条件，避免重复部署</li><li><strong>可观察性</strong>：清晰的日志输出，便于调试</li></ol><h3 id="_6-4-后续优化方向" tabindex="-1">6.4 后续优化方向 <a class="header-anchor" href="#_6-4-后续优化方向" aria-label="Permalink to &quot;6.4 后续优化方向&quot;">​</a></h3><ol><li><p><strong>合约层防御</strong>（长期）：</p><ul><li>在 <code>PaymasterFactory.sol</code> 中添加 owner 强制验证</li><li>在 <code>Paymaster.sol</code> 的 <code>initialize</code> 中添加调用者权限控制</li></ul></li><li><p><strong>SDK 层增强</strong>（已完成）：</p><ul><li>✅ 部署后自动验证 owner</li><li>✅ 提供详细错误信息</li></ul></li><li><p><strong>测试覆盖</strong>：</p><ul><li>✅ l4-setup.ts 覆盖所有操作流程</li><li>⏳ 添加单元测试（针对每个 SDK API）</li></ul></li></ol></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-1bcd8184><!--[--><!--]--><div class="edit-info" data-v-1bcd8184><!----><div class="last-updated" data-v-1bcd8184><p class="VPLastUpdated" data-v-1bcd8184 data-v-1bb0c8a8>Last Updated: <time datetime="2026-01-19T08:57:09.000Z" data-v-1bb0c8a8></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><!----></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/guide/getting-started.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Next page</span><span class="title" data-v-1bcd8184>Getting Started</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-d8b57b2d data-v-566314d4><div class="container" data-v-566314d4><p class="message" data-v-566314d4>Released under the MIT License.</p><p class="copyright" data-v-566314d4>Copyright © 2023-present AAStar Community</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api_@aastar_account_classes_useropclient.md\":\"C73doyuu\",\"api_@aastar_account_functions_createeoawalletclient.md\":\"YVIH-Fbx\",\"api_@aastar_account_functions_getuserophash.md\":\"CVS-6mD0\",\"api_@aastar_account_functions_packuseroplimits.md\":\"DzXBtpzx\",\"api_@aastar_account_functions_tosimplesmartaccount.md\":\"DwBqWS44\",\"api_@aastar_account_index.md\":\"O1AY9cgG\",\"api_@aastar_account_type-aliases_eoawalletclient.md\":\"BN5TSEVN\",\"api_@aastar_account_type-aliases_simplesmartaccount.md\":\"NWZS1zuF\",\"api_@aastar_analytics_classes_analyticsclient.md\":\"DkSU2FQ3\",\"api_@aastar_analytics_index.md\":\"Cx2Bsesn\",\"api_@aastar_community_classes_communityclient.md\":\"fUi-wb5v\",\"api_@aastar_community_index.md\":\"Cr0mohLo\",\"api_@aastar_community_interfaces_communitylaunchconfig.md\":\"BMgAj0IB\",\"api_@aastar_community_interfaces_communitystats.md\":\"9-RlkUCl\",\"api_@aastar_community_interfaces_sbtruleconfig.md\":\"CmG7_MkL\",\"api_@aastar_community_interfaces_xpntsissuanceparams.md\":\"DVmUp8HB\",\"api_@aastar_core_classes_baseclient.md\":\"DHI2HLsj\",\"api_@aastar_core_classes_blssigner.md\":\"DT-CAHjK\",\"api_@aastar_core_classes_bundlerclient.md\":\"COtAo_F5\",\"api_@aastar_core_classes_contractconfigmanager.md\":\"YU8AxQIV\",\"api_@aastar_core_classes_requirementchecker.md\":\"Ctp7aFFN\",\"api_@aastar_core_classes_sepoliafaucetapi.md\":\"C_UTgR38\",\"api_@aastar_core_classes_statevalidator.md\":\"DCdBkXGt\",\"api_@aastar_core_enumerations_entrypointversion.md\":\"DG1GEd-J\",\"api_@aastar_core_enumerations_nodetype.md\":\"B7UT9sxl\",\"api_@aastar_core_enumerations_rolepermissionlevel.md\":\"CX9cQCrh\",\"api_@aastar_core_functions_accountactions.md\":\"DXzfdnLi\",\"api_@aastar_core_functions_accountfactoryactions.md\":\"Cp_0QvBN\",\"api_@aastar_core_functions_aggregatoractions.md\":\"5pHoXz2U\",\"api_@aastar_core_functions_createaastarpublicclient.md\":\"CHPSKRi2\",\"api_@aastar_core_functions_dvtactions.md\":\"CI97LqEy\",\"api_@aastar_core_functions_entrypointactions.md\":\"CriUz1k2\",\"api_@aastar_core_functions_getaddressurl.md\":\"C0XPxpND\",\"api_@aastar_core_functions_getallcommunityconfigs.md\":\"DtCReXoH\",\"api_@aastar_core_functions_getallv2contracts.md\":\"CV8ghWWa\",\"api_@aastar_core_functions_getblockexplorer.md\":\"BTcwsij6\",\"api_@aastar_core_functions_getchainid.md\":\"BbnEpkFw\",\"api_@aastar_core_functions_getcommunities.md\":\"BRUXMRJM\",\"api_@aastar_core_functions_getcommunity.md\":\"6rlrnV09\",\"api_@aastar_core_functions_getcommunityconfig.md\":\"BK-mb3pH\",\"api_@aastar_core_functions_getcontract.md\":\"BeNzKemM\",\"api_@aastar_core_functions_getcontractnetworks.md\":\"FO2_Pha-\",\"api_@aastar_core_functions_getcontracts.md\":\"BlX87zcq\",\"api_@aastar_core_functions_getcorecontracts.md\":\"C-e_L6sw\",\"api_@aastar_core_functions_getdeploymentdate.md\":\"Cigb3Y7w\",\"api_@aastar_core_functions_getentrypoint.md\":\"DA8WtW_O\",\"api_@aastar_core_functions_getnetwork.md\":\"KE4F5Kx0\",\"api_@aastar_core_functions_getpaymasterv4_1.md\":\"BhViiWjo\",\"api_@aastar_core_functions_getrolename.md\":\"CQ3iHSpN\",\"api_@aastar_core_functions_getrpcurl.md\":\"Di6rbi-G\",\"api_@aastar_core_functions_getsimpleaccountfactory.md\":\"BqujVnKv\",\"api_@aastar_core_functions_getsuperpaymasterv2.md\":\"BvEdw8MV\",\"api_@aastar_core_functions_gettestaccounts.md\":\"yh_uK162\",\"api_@aastar_core_functions_gettesttokencontracts.md\":\"Cl_OHN64\",\"api_@aastar_core_functions_gettokencontracts.md\":\"B6mwzxxe\",\"api_@aastar_core_functions_gettxurl.md\":\"zfYrSZtY\",\"api_@aastar_core_functions_getv2contractbyaddress.md\":\"DsFEZEtq\",\"api_@aastar_core_functions_getv2contractbyname.md\":\"DuaaDf2X\",\"api_@aastar_core_functions_getv2contractsbydate.md\":\"DXbHp3pA\",\"api_@aastar_core_functions_gtokenactions.md\":\"WpSKVo6z\",\"api_@aastar_core_functions_iscontractnetworksupported.md\":\"DIobarhc\",\"api_@aastar_core_functions_isregisteredcommunity.md\":\"DmZrNont\",\"api_@aastar_core_functions_isv2contract.md\":\"DMgvuwNR\",\"api_@aastar_core_functions_paymasteractions.md\":\"DF46neoU\",\"api_@aastar_core_functions_paymasterfactoryactions.md\":\"BJpjqbLX\",\"api_@aastar_core_functions_registryactions.md\":\"DezNMenN\",\"api_@aastar_core_functions_reputationactions.md\":\"DPKYyGIA\",\"api_@aastar_core_functions_sbtactions.md\":\"lhyzieAP\",\"api_@aastar_core_functions_stakingactions.md\":\"suBwD4Fz\",\"api_@aastar_core_functions_superpaymasteractions.md\":\"D4z7T4SE\",\"api_@aastar_core_functions_tokenactions.md\":\"DUhShUB1\",\"api_@aastar_core_functions_xpntsfactoryactions.md\":\"BTf6l2c8\",\"api_@aastar_core_functions_xpntstokenactions.md\":\"B9WVyi_G\",\"api_@aastar_core_index.md\":\"BDuBtS9o\",\"api_@aastar_core_interfaces_accountbalance.md\":\"D7cmGGzR\",\"api_@aastar_core_interfaces_balancevalidationparams.md\":\"BBntRpd7\",\"api_@aastar_core_interfaces_bundlerresponse.md\":\"D0ithgez\",\"api_@aastar_core_interfaces_clientconfig.md\":\"C9gMwvmV\",\"api_@aastar_core_interfaces_communityconfig.md\":\"BOIXmFrD\",\"api_@aastar_core_interfaces_contractversion.md\":\"BDAMfl79\",\"api_@aastar_core_interfaces_deploymentvalidationparams.md\":\"2GW4QKnb\",\"api_@aastar_core_interfaces_publicclient.md\":\"DaspnmgD\",\"api_@aastar_core_interfaces_roleconfig.md\":\"Be-rhUx_\",\"api_@aastar_core_interfaces_rolerequirement.md\":\"BYxfAFqT\",\"api_@aastar_core_interfaces_rolevalidationparams.md\":\"C5okKKlp\",\"api_@aastar_core_interfaces_superpaymasterconfig.md\":\"BkKQOWQn\",\"api_@aastar_core_interfaces_tokenbalancevalidationparams.md\":\"BBXq7Qo6\",\"api_@aastar_core_interfaces_transactionoptions.md\":\"7I8-s3eE\",\"api_@aastar_core_interfaces_useroperationv07.md\":\"DpD1JOZK\",\"api_@aastar_core_interfaces_validationparams.md\":\"DTNFSpJ6\",\"api_@aastar_core_interfaces_validationresult.md\":\"DxL3RFrc\",\"api_@aastar_core_interfaces_walletclient.md\":\"W-8qQO1n\",\"api_@aastar_core_type-aliases_accountactions.md\":\"YDgJqjNK\",\"api_@aastar_core_type-aliases_accountfactoryactions.md\":\"BkukQYMZ\",\"api_@aastar_core_type-aliases_aggregatoractions.md\":\"o6HyzXQf\",\"api_@aastar_core_type-aliases_businessresult.md\":\"DoEUrEx2\",\"api_@aastar_core_type-aliases_contractcategory.md\":\"Dn43FoZx\",\"api_@aastar_core_type-aliases_contractnetwork.md\":\"CSsXWeUq\",\"api_@aastar_core_type-aliases_dvtactions.md\":\"o5C1J9Lk\",\"api_@aastar_core_type-aliases_entrypointactions.md\":\"DkNUT432\",\"api_@aastar_core_type-aliases_erc20actions.md\":\"BS0kOotf\",\"api_@aastar_core_type-aliases_faucetconfig.md\":\"Dz0-n3Kr\",\"api_@aastar_core_type-aliases_faucetpreparationresult.md\":\"BtVBJyz_\",\"api_@aastar_core_type-aliases_gtokenactions.md\":\"CMSR-siF\",\"api_@aastar_core_type-aliases_networkcontracts.md\":\"CM45H_h2\",\"api_@aastar_core_type-aliases_operatorconfig.md\":\"at2wU-DC\",\"api_@aastar_core_type-aliases_paymasteractions.md\":\"D3t71qL6\",\"api_@aastar_core_type-aliases_paymasterfactoryactions.md\":\"CWLJGO0x\",\"api_@aastar_core_type-aliases_registryactions.md\":\"RFr0Yspe\",\"api_@aastar_core_type-aliases_reputationactions.md\":\"B-9x9uwB\",\"api_@aastar_core_type-aliases_reputationbreakdown.md\":\"C_2hfpPv\",\"api_@aastar_core_type-aliases_reputationrule.md\":\"DNe7VKIa\",\"api_@aastar_core_type-aliases_roleconfigdetailed.md\":\"i5KXiVK1\",\"api_@aastar_core_type-aliases_sbtactions.md\":\"y8GMEb87\",\"api_@aastar_core_type-aliases_sbtdata.md\":\"Ao1iw0bG\",\"api_@aastar_core_type-aliases_sbtmembership.md\":\"C7BtG6tv\",\"api_@aastar_core_type-aliases_slashrecord.md\":\"CGNfDCpo\",\"api_@aastar_core_type-aliases_stakingactions.md\":\"CobJZTK0\",\"api_@aastar_core_type-aliases_superpaymasteractions.md\":\"Cj-JyRC2\",\"api_@aastar_core_type-aliases_supportednetwork.md\":\"d8UnzAXh\",\"api_@aastar_core_type-aliases_tokenactions.md\":\"CIY0cVAW\",\"api_@aastar_core_type-aliases_xpntsfactoryactions.md\":\"DsljDWyq\",\"api_@aastar_core_type-aliases_xpntstokenactions.md\":\"DoVKxoIq\",\"api_@aastar_core_variables_aastar_community.md\":\"C4HepdbV\",\"api_@aastar_core_variables_all_addresses.md\":\"BDqHG9_N\",\"api_@aastar_core_variables_all_roles.md\":\"vwM6ntf5\",\"api_@aastar_core_variables_apnts_address.md\":\"WO-REVY5\",\"api_@aastar_core_variables_bls_aggregator_address.md\":\"1PSsrPiQ\",\"api_@aastar_core_variables_bls_validator_address.md\":\"tD_orahr\",\"api_@aastar_core_variables_blsaggregatorabi.md\":\"BmKznMfl\",\"api_@aastar_core_variables_blsaggregatorartifact.md\":\"93gmnBfD\",\"api_@aastar_core_variables_blshelpers.md\":\"BMLwsNOT\",\"api_@aastar_core_variables_blsvalidatorabi.md\":\"C7bx5wFN\",\"api_@aastar_core_variables_blsvalidatorartifact.md\":\"Bu8Kih0V\",\"api_@aastar_core_variables_bps_denominator.md\":\"DSOKPeEC\",\"api_@aastar_core_variables_branding.md\":\"DWbBAvcG\",\"api_@aastar_core_variables_bread_community.md\":\"CEc0_e_Q\",\"api_@aastar_core_variables_chain_mainnet.md\":\"BkWCubJZ\",\"api_@aastar_core_variables_chain_sepolia.md\":\"CeYjAfRv\",\"api_@aastar_core_variables_communities.md\":\"C3p3QMxu\",\"api_@aastar_core_variables_community_owners.md\":\"Xm4uBdmI\",\"api_@aastar_core_variables_contract_metadata.md\":\"Dm33srG7\",\"api_@aastar_core_variables_contract_src_hash.md\":\"BdcqkFh4\",\"api_@aastar_core_variables_contracts.md\":\"C9cTSORY\",\"api_@aastar_core_variables_core_addresses.md\":\"DnYbbs6b\",\"api_@aastar_core_variables_default_admin_role.md\":\"CMW98FlY\",\"api_@aastar_core_variables_default_apnts_price_usd.md\":\"rmgPX9dR\",\"api_@aastar_core_variables_default_call_gas_limit.md\":\"c7RXnkWq\",\"api_@aastar_core_variables_default_gas_token_mint_amount.md\":\"DxJ1oUbK\",\"api_@aastar_core_variables_default_pre_verification_gas.md\":\"DufvkYLY\",\"api_@aastar_core_variables_default_timeout_ms.md\":\"DFnNwvS8\",\"api_@aastar_core_variables_default_token_name.md\":\"DZN4dEmx\",\"api_@aastar_core_variables_default_token_symbol.md\":\"ByW45yIO\",\"api_@aastar_core_variables_default_usdt_mint_amount.md\":\"BZCOtBcD\",\"api_@aastar_core_variables_default_verification_gas_limit.md\":\"DAlsNIue\",\"api_@aastar_core_variables_dvt_validator_address.md\":\"yoeOcXdb\",\"api_@aastar_core_variables_dvtvalidatorabi.md\":\"CweKSi7E\",\"api_@aastar_core_variables_dvtvalidatorartifact.md\":\"B6hpnKjF\",\"api_@aastar_core_variables_entry_point_0_8_address.md\":\"BsUST8Qv\",\"api_@aastar_core_variables_entry_point_0_9_address.md\":\"CwNxnc3v\",\"api_@aastar_core_variables_entry_point_address.md\":\"CiKrJJeY\",\"api_@aastar_core_variables_entrypointabi.md\":\"C8BfAd9X\",\"api_@aastar_core_variables_entrypointartifact.md\":\"RW1KEuYN\",\"api_@aastar_core_variables_faucet_api_url.md\":\"BlWwX3TD\",\"api_@aastar_core_variables_gtoken_address.md\":\"D34nZ1uc\",\"api_@aastar_core_variables_gtoken_staking_address.md\":\"DfVukCTO\",\"api_@aastar_core_variables_gtokenabi.md\":\"BeqNcawv\",\"api_@aastar_core_variables_gtokenartifact.md\":\"BPnM7pir\",\"api_@aastar_core_variables_gtokenstakingabi.md\":\"CaTsdm0c\",\"api_@aastar_core_variables_gtokenstakingartifact.md\":\"aVz1nxqz\",\"api_@aastar_core_variables_initial_role_stakes.md\":\"BKa4H8t_\",\"api_@aastar_core_variables_links.md\":\"C2OqJ1F3\",\"api_@aastar_core_variables_max_service_fee.md\":\"CRP2QitQ\",\"api_@aastar_core_variables_monitoring_addresses.md\":\"CMsOuPs6\",\"api_@aastar_core_variables_mysbtabi.md\":\"DaUp28BS\",\"api_@aastar_core_variables_mysbtartifact.md\":\"BKBe3GLj\",\"api_@aastar_core_variables_networks.md\":\"BuIST3k2\",\"api_@aastar_core_variables_node_stake_amounts.md\":\"CJi5F_nV\",\"api_@aastar_core_variables_official_addresses.md\":\"BYKzgAPm\",\"api_@aastar_core_variables_paymaster_addresses.md\":\"Bv9sX178\",\"api_@aastar_core_variables_paymaster_factory_address.md\":\"Cr5uX_wg\",\"api_@aastar_core_variables_paymaster_v4_impl_address.md\":\"HIPwyauL\",\"api_@aastar_core_variables_paymasterabi.md\":\"CaSbXFVN\",\"api_@aastar_core_variables_paymasterartifact.md\":\"au1G_3_T\",\"api_@aastar_core_variables_paymasterfactoryabi.md\":\"DjLVjZw_\",\"api_@aastar_core_variables_paymasterfactoryartifact.md\":\"CEB3OYs_\",\"api_@aastar_core_variables_registry_address.md\":\"C69GdAf6\",\"api_@aastar_core_variables_registryabi.md\":\"BZc1G7s5\",\"api_@aastar_core_variables_registryartifact.md\":\"D1ctFlb3\",\"api_@aastar_core_variables_reputation_system_address.md\":\"DG7_JHXG\",\"api_@aastar_core_variables_reputationsystemabi.md\":\"CCH08AlT\",\"api_@aastar_core_variables_reputationsystemartifact.md\":\"Dljx9ogx\",\"api_@aastar_core_variables_role_anode.md\":\"YybeGrsz\",\"api_@aastar_core_variables_role_community.md\":\"2ijDaq1p\",\"api_@aastar_core_variables_role_dvt.md\":\"DhBjR7Vm\",\"api_@aastar_core_variables_role_enduser.md\":\"CFdIRG_d\",\"api_@aastar_core_variables_role_kms.md\":\"BeUB8kQ0\",\"api_@aastar_core_variables_role_names.md\":\"BFMKEqlv\",\"api_@aastar_core_variables_role_paymaster_aoa.md\":\"C0XGVA3J\",\"api_@aastar_core_variables_role_paymaster_super.md\":\"BOrEH-gI\",\"api_@aastar_core_variables_role_permission_levels.md\":\"C9YCqfFr\",\"api_@aastar_core_variables_sbt_address.md\":\"DHcTHIQx\",\"api_@aastar_core_variables_sepolia_contracts.md\":\"BEI5YMW0\",\"api_@aastar_core_variables_sepolia_v2_versions.md\":\"DEf7cu7T\",\"api_@aastar_core_variables_service_fee_rate.md\":\"DlZzTNPW\",\"api_@aastar_core_variables_simpleaccountabi.md\":\"BDpazEyL\",\"api_@aastar_core_variables_simpleaccountartifact.md\":\"unxDELzg\",\"api_@aastar_core_variables_simpleaccountfactoryabi.md\":\"biZCjvtD\",\"api_@aastar_core_variables_simpleaccountfactoryartifact.md\":\"Cz9B8SFP\",\"api_@aastar_core_variables_super_paymaster_address.md\":\"D9bJETal\",\"api_@aastar_core_variables_superpaymasterabi.md\":\"CahjesOA\",\"api_@aastar_core_variables_superpaymasterartifact.md\":\"BGiZr8RN\",\"api_@aastar_core_variables_test_account_addresses.md\":\"CnMeSOR6\",\"api_@aastar_core_variables_test_account_pool_size.md\":\"B6XKMwTw\",\"api_@aastar_core_variables_test_communities.md\":\"Ca__A-7t\",\"api_@aastar_core_variables_test_token_addresses.md\":\"BQbx2b-u\",\"api_@aastar_core_variables_token_addresses.md\":\"0aL0wxiL\",\"api_@aastar_core_variables_v2_summary.md\":\"C5zW9XVG\",\"api_@aastar_core_variables_xpnts_factory_address.md\":\"BKgVpsA5\",\"api_@aastar_core_variables_xpntsfactoryabi.md\":\"B041onh5\",\"api_@aastar_core_variables_xpntsfactoryartifact.md\":\"DlvkrjyQ\",\"api_@aastar_core_variables_xpntstokenabi.md\":\"CbijzORM\",\"api_@aastar_core_variables_xpntstokenartifact.md\":\"BzxMxjdr\",\"api_@aastar_dapp_classes_dvtclient.md\":\"DexFgVma\",\"api_@aastar_dapp_functions_usecreditscore.md\":\"WGKe-1dC\",\"api_@aastar_dapp_functions_usesuperpaymaster.md\":\"COT1ycv8\",\"api_@aastar_dapp_index.md\":\"C7GPsRHS\",\"api_@aastar_enduser_classes_communityclient.md\":\"Dd51Jufj\",\"api_@aastar_enduser_classes_userclient.md\":\"7jzdYWrH\",\"api_@aastar_enduser_index.md\":\"CbsWXgAB\",\"api_@aastar_enduser_interfaces_communityclientconfig.md\":\"BEf6QG_z\",\"api_@aastar_enduser_interfaces_communityinfo.md\":\"BakK7gbN\",\"api_@aastar_enduser_interfaces_createcommunityparams.md\":\"CJjrWOot\",\"api_@aastar_enduser_interfaces_userclientconfig.md\":\"BdzHYGTl\",\"api_@aastar_identity_classes_reputationclient.md\":\"CHtOwYNB\",\"api_@aastar_identity_functions_checkmysbt.md\":\"B525kgOp\",\"api_@aastar_identity_functions_getmysbtid.md\":\"DL2BMZI_\",\"api_@aastar_identity_index.md\":\"Ca3ES1wF\",\"api_@aastar_paymaster_classes_paymasterclient.md\":\"pM9W9TIC\",\"api_@aastar_paymaster_classes_paymasteroperator.md\":\"CH1Mi40O\",\"api_@aastar_paymaster_classes_superpaymasteradminclient.md\":\"o2B8lhUP\",\"api_@aastar_paymaster_classes_superpaymasterclient.md\":\"bkwyznV6\",\"api_@aastar_paymaster_functions_buildpaymasterdata.md\":\"BRYhtN-f\",\"api_@aastar_paymaster_functions_buildsuperpaymasterdata.md\":\"Cpol_DKj\",\"api_@aastar_paymaster_functions_checkeligibility.md\":\"B3v4DcuE\",\"api_@aastar_paymaster_functions_formatuseropv07.md\":\"Dfr3uO5M\",\"api_@aastar_paymaster_functions_getpaymasterv4middleware.md\":\"lydJoap2\",\"api_@aastar_paymaster_functions_getsuperpaymastermiddleware.md\":\"DY-9XZr1\",\"api_@aastar_paymaster_functions_getuserophashv07.md\":\"zrumwE5C\",\"api_@aastar_paymaster_functions_tunegaslimit.md\":\"xXkjkB1n\",\"api_@aastar_paymaster_index.md\":\"vcIS6VUU\",\"api_@aastar_paymaster_type-aliases_gaslessreadinessreport.md\":\"BiaNghjt\",\"api_@aastar_paymaster_type-aliases_gaslesstransactionconfig.md\":\"DciasMCL\",\"api_@aastar_paymaster_type-aliases_paymasterconfig.md\":\"CP0Ttpf4\",\"api_@aastar_paymaster_type-aliases_paymasterv4middlewareconfig.md\":\"BNWipRBZ\",\"api_@aastar_sdk.md\":\"DHE5hYOs\",\"api_@aastar_sdk_index.md\":\"BerSaXAp\",\"api_@aastar_tokens_classes_financeclient.md\":\"BfoFOBuQ\",\"api_@aastar_tokens_index.md\":\"C2WW_yOC\",\"api_index.md\":\"Dkc3St2Q\",\"api_modules_sdk.md\":\"CcosdMKh\",\"changelog.md\":\"B2fAsEh0\",\"examples_community-flow.md\":\"DgD_jDkf\",\"examples_enduser-flow.md\":\"DTKmEjlQ\",\"examples_index.md\":\"C3eM_8lb\",\"examples_multi-chain.md\":\"BvC4Y7K8\",\"examples_operator-flow.md\":\"BmdV8r6H\",\"examples_readme.md\":\"C9svwnyj\",\"guide_abi_maintenance_plan.md\":\"Dw7Y-lO3\",\"guide_api_compliance_report.md\":\"C0F6k33W\",\"guide_api_reference.md\":\"BPR6C-M-\",\"guide_cli_guide.md\":\"Bqvnfo8e\",\"guide_concepts_account-abstraction.md\":\"-o7nURb8\",\"guide_concepts_rainbow-bridge.md\":\"DVTw1e7F\",\"guide_concepts_reputation.md\":\"Bu6KfmwY\",\"guide_concepts_superpaymaster.md\":\"BGq21sdZ\",\"guide_configuration_sync.md\":\"DkNQcZdZ\",\"guide_dao_mining_distribution_plan.md\":\"RkJ4ztot\",\"guide_demo_refactor_plan.md\":\"CQNvnXgE\",\"guide_deployments_verify.op-sepolia.contracts.md\":\"DcIxIAYN\",\"guide_deployments_verify.sepolia.contracts.md\":\"DJDT_EG1\",\"guide_docs_abi_maintenance_plan.md\":\"BDyn31Pr\",\"guide_docs_api_compliance_report.md\":\"BrgdsKHC\",\"guide_docs_api_reference.md\":\"BfHlrBjG\",\"guide_docs_configuration_sync.md\":\"DI_ICoUR\",\"guide_docs_dao_mining_distribution_plan.md\":\"Cnj-QMgt\",\"guide_docs_demo_refactor_plan.md\":\"Bi_oP08n\",\"guide_docs_documentation_plan.md\":\"BE3cw0iu\",\"guide_docs_env_sepolia_update.md\":\"CBlp9a9R\",\"guide_docs_l2_business_clients_plan.md\":\"rEVFYwPq\",\"guide_docs_l4_manual_test_cheatsheet.md\":\"BGljJ8MX\",\"guide_docs_old-solution.md\":\"CPqzQGvE\",\"guide_docs_paper-data-collection.md\":\"Bylj0WO6\",\"guide_docs_plan.md\":\"N7AOWs39\",\"guide_docs_regression_testing_guide.md\":\"CMVEkic_\",\"guide_docs_release_plan_v0.16.12.md\":\"CD0j0ayF\",\"guide_docs_reputation-to-credit_mapping_whitepaper.md\":\"B9IX_V9i\",\"guide_docs_script_comparison_report.md\":\"AGGjQFpq\",\"guide_docs_sdk_abi_coverage.md\":\"ByN5kAjo\",\"guide_docs_sdk_coverage_strategy.md\":\"B-GUoGGi\",\"guide_docs_sdk_optimization_evaluation_plan.md\":\"C88sgW5u\",\"guide_docs_sdk_regression_and_api_plan.md\":\"DPrYaPxW\",\"guide_docs_sdk_stage3_plan.md\":\"CANl44oO\",\"guide_docs_sepolia_env_reference.md\":\"D0tZTBbj\",\"guide_docs_sepolia_latest_deployment.md\":\"LHbsCqZS\",\"guide_docs_stage3.md\":\"Bd-rnD9D\",\"guide_docs_technical_plan.md\":\"DGaWpWLt\",\"guide_docs_test_coverage_matrix.md\":\"Bcl7kkv-\",\"guide_docs_tester_guide_gasless.md\":\"CVljbRiU\",\"guide_docs_todo_sdk_coverage.md\":\"BcLi92We\",\"guide_docs_user_case_design.md\":\"CHlOO6Go\",\"guide_docs_verifier_l4_gasless_plan.md\":\"vI0owz-J\",\"guide_docs_verify.op-sepolia.contracts.md\":\"D7yoNp7a\",\"guide_docs_verify.sepolia.contracts.md\":\"BJA__1Wz\",\"guide_documentation_plan.md\":\"DYBs0Pyd\",\"guide_env_sepolia_update.md\":\"BZLz5u_l\",\"guide_getting-started.md\":\"fna9CTxp\",\"guide_installation.md\":\"BxfSQK-6\",\"guide_l2_business_clients_plan.md\":\"_6GyjfTF\",\"guide_l4_manual_test_cheatsheet.md\":\"BubwetzK\",\"guide_old-solution.md\":\"Dywjg-yw\",\"guide_packages_analytics_index.md\":\"Bqghtc50\",\"guide_paper-data-collection.md\":\"D5jzlZW-\",\"guide_plan.md\":\"Bn5_2o5b\",\"guide_quick-start.md\":\"CTsDi7kr\",\"guide_regression_testing_guide.md\":\"BPYpZVVF\",\"guide_release_plan_v0.16.12.md\":\"B2AHDVJa\",\"guide_reputation-to-credit_mapping_whitepaper.md\":\"DOKSmQBd\",\"guide_script_comparison_report.md\":\"ClmXLzsQ\",\"guide_sdk_abi_coverage.md\":\"9Q-hiKq1\",\"guide_sdk_coverage_strategy.md\":\"BcJhPqh9\",\"guide_sdk_optimization_evaluation_plan.md\":\"D2qhT6iJ\",\"guide_sdk_regression_and_api_plan.md\":\"CduhfPTQ\",\"guide_sdk_stage3_plan.md\":\"9NujDSsA\",\"guide_security-solution.md\":\"B0c9zLlV\",\"guide_sepolia_env_reference.md\":\"D76NylgE\",\"guide_sepolia_latest_deployment.md\":\"ZPnwJili\",\"guide_stage3.md\":\"DWOXiggR\",\"guide_task_breakdown.md\":\"DZBvxYlO\",\"guide_technical_plan.md\":\"ChmmBFeh\",\"guide_test_commands.md\":\"BnDxUIVc\",\"guide_test_coverage_matrix.md\":\"DXwZXWPK\",\"guide_tester_guide_gasless.md\":\"BMTxWTWn\",\"guide_todo_sdk_coverage.md\":\"BQkeUwuJ\",\"guide_use-cases_community-management.md\":\"BTRrGC5W\",\"guide_use-cases_gasless-transactions.md\":\"vLKej9WB\",\"guide_use-cases_operator-staking.md\":\"C9_O60Ab\",\"guide_use-cases_yop.md\":\"D_jvIuwl\",\"guide_user_case_design.md\":\"IcxKtgfA\",\"guide_verifier_l4_gasless_plan.md\":\"aBW_X0oP\",\"guide_verify.op-sepolia.contracts.md\":\"B3SN6OVV\",\"guide_verify.sepolia.contracts.md\":\"DmcLJMSY\",\"index.md\":\"CYSY2ZlI\",\"local_dev.md\":\"DhK2s7iP\",\"readme.md\":\"BwNUAi_C\",\"zh_api_index.md\":\"DftDxr1B\",\"zh_examples_community-flow.md\":\"BbJsc6vE\",\"zh_examples_complete-workflow.md\":\"B4Ei9Rb1\",\"zh_examples_enduser-flow.md\":\"B4eUX_ep\",\"zh_examples_index.md\":\"QHDrC3mg\",\"zh_examples_multi-chain.md\":\"D1sy4FXQ\",\"zh_examples_operator-flow.md\":\"DOZ9ssVY\",\"zh_guide_cli_guide.md\":\"CTP2voaB\",\"zh_guide_concepts_account-abstraction.md\":\"DoQMahtA\",\"zh_guide_concepts_rainbow-bridge.md\":\"zXCczwr8\",\"zh_guide_concepts_reputation.md\":\"BqMsB9fk\",\"zh_guide_concepts_superpaymaster.md\":\"wayfyUFf\",\"zh_guide_documentation_plan.md\":\"CasmNw3Q\",\"zh_guide_getting-started.md\":\"DkVCU8n3\",\"zh_guide_installation.md\":\"c4yn9Gfc\",\"zh_guide_old-solution.md\":\"sgNtqU5g\",\"zh_guide_paper-data-collection.md\":\"BYbgTo-L\",\"zh_guide_plan.md\":\"BbAobYhH\",\"zh_guide_quick-start.md\":\"BMMccIsi\",\"zh_guide_sdk-readme.md\":\"NWW9ptBt\",\"zh_guide_sdk_optimization_evaluation_plan.md\":\"Dr7xT8Me\",\"zh_guide_security-solution.md\":\"BqpjhFF2\",\"zh_guide_task_breakdown.md\":\"Djdsco8k\",\"zh_guide_technical_plan.md\":\"DR1h5uTA\",\"zh_guide_test_commands.md\":\"C-RG-Lq_\",\"zh_guide_test_coverage_matrix.md\":\"CgITLUf0\",\"zh_guide_use-cases_community-management.md\":\"CXtVHG7f\",\"zh_guide_use-cases_gasless-transactions.md\":\"JDFV57Dn\",\"zh_guide_use-cases_operator-staking.md\":\"B03-9BLv\",\"zh_guide_use-cases_yop.md\":\"DTHb57p_\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en\",\"dir\":\"ltr\",\"title\":\"AAStar SDK\",\"description\":\"Build Your Own Protocol with Account Abstraction\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/aastar-logo.png\",\"lastUpdatedText\":\"Last Updated\",\"outline\":{\"level\":[2,3],\"label\":\"On this page\"},\"nav\":[{\"text\":\"Guide\",\"link\":\"/guide/getting-started\"},{\"text\":\"API\",\"link\":\"/api/\"},{\"text\":\"Examples\",\"link\":\"/examples/\"},{\"text\":\"Deployments\",\"link\":\"/guide/deployments/verify.sepolia.contracts\"},{\"text\":\"History\",\"link\":\"/changelog\"}],\"sidebar\":{\"/guide/\":[{\"text\":\"Introduction\",\"items\":[{\"text\":\"Getting Started\",\"link\":\"/guide/getting-started\"},{\"text\":\"Installation\",\"link\":\"/guide/installation\"},{\"text\":\"Quick Start\",\"link\":\"/guide/quick-start\"}]},{\"text\":\"Core Concepts\",\"items\":[{\"text\":\"Account Abstraction\",\"link\":\"/guide/concepts/account-abstraction\"},{\"text\":\"SuperPaymaster (AOA+)\",\"link\":\"/guide/concepts/superpaymaster\"},{\"text\":\"EOA Rainbow Bridge\",\"link\":\"/guide/concepts/rainbow-bridge\"},{\"text\":\"Reputation System\",\"link\":\"/guide/concepts/reputation\"}]},{\"text\":\"Use Cases\",\"items\":[{\"text\":\"Community Management\",\"link\":\"/guide/use-cases/community-management\"},{\"text\":\"Gasless Transactions\",\"link\":\"/guide/use-cases/gasless-transactions\"},{\"text\":\"Operator Staking\",\"link\":\"/guide/use-cases/operator-staking\"},{\"text\":\"Build Your Own Protocol\",\"link\":\"/guide/use-cases/yop\"}]},{\"text\":\"Deployments\",\"items\":[{\"text\":\"Sepolia Contracts\",\"link\":\"/guide/deployments/verify.sepolia.contracts\"},{\"text\":\"OP-Sepolia Contracts\",\"link\":\"/guide/deployments/verify.op-sepolia.contracts\"}]}],\"/zh/guide/\":[{\"text\":\"快速入门\",\"items\":[{\"text\":\"开始使用\",\"link\":\"/zh/guide/getting-started\"},{\"text\":\"安裝\",\"link\":\"/zh/guide/installation\"},{\"text\":\"快速開始\",\"link\":\"/zh/guide/quick-start\"}]},{\"text\":\"核心概念\",\"items\":[{\"text\":\"賬戶抽象\",\"link\":\"/zh/guide/concepts/account-abstraction\"},{\"text\":\"SuperPaymaster (AOA+)\",\"link\":\"/zh/guide/concepts/superpaymaster\"},{\"text\":\"EOA Rainbow Bridge\",\"link\":\"/zh/guide/concepts/rainbow-bridge\"},{\"text\":\"聲譽系統\",\"link\":\"/zh/guide/concepts/reputation\"}]},{\"text\":\"应用场景\",\"items\":[{\"text\":\"社区管理\",\"link\":\"/zh/guide/use-cases/community-management\"},{\"text\":\"Gasless 交易\",\"link\":\"/zh/guide/use-cases/gasless-transactions\"},{\"text\":\"Operator 質押\",\"link\":\"/zh/guide/use-cases/operator-staking\"},{\"text\":\"自建協議\",\"link\":\"/zh/guide/use-cases/yop\"}]}],\"/api/\":[{\"text\":\"Getting Started\",\"items\":[{\"text\":\"Overview\",\"link\":\"/api/\"},{\"text\":\"Installation\",\"link\":\"/api/@aastar/sdk#installation\"},{\"text\":\"Quick Start\",\"link\":\"/api/@aastar/sdk#usage\"}]},{\"text\":\"@aastar/sdk (Meta Package)\",\"items\":[{\"text\":\"Overview\",\"link\":\"/api/@aastar/sdk\"},{\"text\":\"Node.js Tools\",\"link\":\"/api/@aastar/sdk/node\"}]},{\"text\":\"Core Modules\",\"collapsed\":false,\"items\":[{\"text\":\"@aastar/core\",\"link\":\"/api/@aastar/core\"},{\"text\":\"@aastar/account\",\"link\":\"/api/@aastar/account\"},{\"text\":\"@aastar/paymaster\",\"link\":\"/api/@aastar/paymaster\"},{\"text\":\"@aastar/tokens\",\"link\":\"/api/@aastar/tokens\"},{\"text\":\"@aastar/identity\",\"link\":\"/api/@aastar/identity\"},{\"text\":\"@aastar/analytics\",\"link\":\"/api/@aastar/analytics\"},{\"text\":\"@aastar/dapp\",\"link\":\"/api/@aastar/dapp\"}]},{\"text\":\"Examples\",\"items\":[{\"text\":\"SDK Handbooks\",\"link\":\"/api/@aastar/sdk#core-scenarios\"}]}],\"/examples/\":[{\"text\":\"Complete Examples\",\"items\":[{\"text\":\"Overview\",\"link\":\"/examples/\"},{\"text\":\"Operator Flow\",\"link\":\"/examples/operator-flow\"},{\"text\":\"Community Flow\",\"link\":\"/examples/community-flow\"},{\"text\":\"End User Flow\",\"link\":\"/examples/enduser-flow\"},{\"text\":\"Multi-Chain Setup\",\"link\":\"/examples/multi-chain\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/AAStarCommunity/aastar-sdk\"},{\"icon\":\"discord\",\"link\":\"https://discord.gg/aastar\"}],\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2023-present AAStar Community\"},\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>